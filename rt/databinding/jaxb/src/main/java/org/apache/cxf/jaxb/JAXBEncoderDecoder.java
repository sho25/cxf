begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_comment
comment|/**  * Licensed to the Apache Software Foundation (ASF) under one  * or more contributor license agreements. See the NOTICE file  * distributed with this work for additional information  * regarding copyright ownership. The ASF licenses this file  * to you under the Apache License, Version 2.0 (the  * "License"); you may not use this file except in compliance  * with the License. You may obtain a copy of the License at  *  * http://www.apache.org/licenses/LICENSE-2.0  *  * Unless required by applicable law or agreed to in writing,  * software distributed under the License is distributed on an  * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY  * KIND, either express or implied. See the License for the  * specific language governing permissions and limitations  * under the License.  */
end_comment

begin_package
package|package
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|jaxb
package|;
end_package

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|InputStream
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|OutputStream
import|;
end_import

begin_import
import|import
name|java
operator|.
name|lang
operator|.
name|reflect
operator|.
name|Array
import|;
end_import

begin_import
import|import
name|java
operator|.
name|lang
operator|.
name|reflect
operator|.
name|Constructor
import|;
end_import

begin_import
import|import
name|java
operator|.
name|lang
operator|.
name|reflect
operator|.
name|Field
import|;
end_import

begin_import
import|import
name|java
operator|.
name|lang
operator|.
name|reflect
operator|.
name|GenericArrayType
import|;
end_import

begin_import
import|import
name|java
operator|.
name|lang
operator|.
name|reflect
operator|.
name|Method
import|;
end_import

begin_import
import|import
name|java
operator|.
name|lang
operator|.
name|reflect
operator|.
name|Modifier
import|;
end_import

begin_import
import|import
name|java
operator|.
name|lang
operator|.
name|reflect
operator|.
name|ParameterizedType
import|;
end_import

begin_import
import|import
name|java
operator|.
name|lang
operator|.
name|reflect
operator|.
name|Type
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|ArrayList
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Arrays
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Collection
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|List
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Map
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|ResourceBundle
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Set
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|logging
operator|.
name|Level
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|logging
operator|.
name|Logger
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|JAXBContext
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|JAXBElement
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|JAXBException
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|Marshaller
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|PropertyException
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|Unmarshaller
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|annotation
operator|.
name|XmlAccessType
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|annotation
operator|.
name|XmlAccessorType
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|annotation
operator|.
name|adapters
operator|.
name|HexBinaryAdapter
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|attachment
operator|.
name|AttachmentMarshaller
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|attachment
operator|.
name|AttachmentUnmarshaller
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|namespace
operator|.
name|QName
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|stream
operator|.
name|XMLEventReader
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|stream
operator|.
name|XMLEventWriter
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|stream
operator|.
name|XMLStreamConstants
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|stream
operator|.
name|XMLStreamException
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|stream
operator|.
name|XMLStreamReader
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|stream
operator|.
name|XMLStreamWriter
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|transform
operator|.
name|stream
operator|.
name|StreamResult
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|validation
operator|.
name|Schema
import|;
end_import

begin_import
import|import
name|org
operator|.
name|w3c
operator|.
name|dom
operator|.
name|Element
import|;
end_import

begin_import
import|import
name|org
operator|.
name|w3c
operator|.
name|dom
operator|.
name|Node
import|;
end_import

begin_import
import|import
name|com
operator|.
name|sun
operator|.
name|xml
operator|.
name|bind
operator|.
name|api
operator|.
name|Bridge
import|;
end_import

begin_import
import|import
name|com
operator|.
name|sun
operator|.
name|xml
operator|.
name|bind
operator|.
name|api
operator|.
name|JAXBRIContext
import|;
end_import

begin_import
import|import
name|com
operator|.
name|sun
operator|.
name|xml
operator|.
name|bind
operator|.
name|api
operator|.
name|TypeReference
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|common
operator|.
name|i18n
operator|.
name|BundleUtils
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|common
operator|.
name|i18n
operator|.
name|Message
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|common
operator|.
name|logging
operator|.
name|LogUtils
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|helpers
operator|.
name|CastUtils
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|interceptor
operator|.
name|Fault
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|service
operator|.
name|model
operator|.
name|MessagePartInfo
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|service
operator|.
name|model
operator|.
name|SchemaInfo
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|staxutils
operator|.
name|StaxUtils
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|staxutils
operator|.
name|W3CDOMStreamWriter
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|ws
operator|.
name|commons
operator|.
name|schema
operator|.
name|XmlSchemaElement
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|ws
operator|.
name|commons
operator|.
name|schema
operator|.
name|XmlSchemaSimpleType
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|ws
operator|.
name|commons
operator|.
name|schema
operator|.
name|XmlSchemaSimpleTypeList
import|;
end_import

begin_comment
comment|/**  * Utility functions for JAXB.  */
end_comment

begin_class
specifier|public
specifier|final
class|class
name|JAXBEncoderDecoder
block|{
specifier|private
specifier|static
specifier|final
name|ResourceBundle
name|BUNDLE
init|=
name|BundleUtils
operator|.
name|getBundle
argument_list|(
name|JAXBEncoderDecoder
operator|.
name|class
argument_list|)
decl_stmt|;
specifier|private
specifier|static
specifier|final
name|Logger
name|LOG
init|=
name|LogUtils
operator|.
name|getLogger
argument_list|(
name|JAXBEncoderDecoder
operator|.
name|class
argument_list|)
decl_stmt|;
specifier|private
name|JAXBEncoderDecoder
parameter_list|()
block|{     }
specifier|private
specifier|static
name|Marshaller
name|createMarshaller
parameter_list|(
name|JAXBContext
name|context
parameter_list|,
name|Class
argument_list|<
name|?
argument_list|>
name|cls
parameter_list|,
name|Map
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|marshallerProperties
parameter_list|)
throws|throws
name|JAXBException
block|{
name|Marshaller
name|jm
init|=
literal|null
decl_stmt|;
if|if
condition|(
name|context
operator|==
literal|null
condition|)
block|{
name|context
operator|=
name|JAXBContext
operator|.
name|newInstance
argument_list|(
name|cls
argument_list|)
expr_stmt|;
block|}
name|jm
operator|=
name|context
operator|.
name|createMarshaller
argument_list|()
expr_stmt|;
name|jm
operator|.
name|setProperty
argument_list|(
name|Marshaller
operator|.
name|JAXB_ENCODING
argument_list|,
literal|"UTF-8"
argument_list|)
expr_stmt|;
name|jm
operator|.
name|setProperty
argument_list|(
name|Marshaller
operator|.
name|JAXB_FORMATTED_OUTPUT
argument_list|,
name|Boolean
operator|.
name|TRUE
argument_list|)
expr_stmt|;
if|if
condition|(
name|marshallerProperties
operator|!=
literal|null
condition|)
block|{
for|for
control|(
name|Map
operator|.
name|Entry
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|propEntry
range|:
name|marshallerProperties
operator|.
name|entrySet
argument_list|()
control|)
block|{
try|try
block|{
name|jm
operator|.
name|setProperty
argument_list|(
name|propEntry
operator|.
name|getKey
argument_list|()
argument_list|,
name|propEntry
operator|.
name|getValue
argument_list|()
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|PropertyException
name|pe
parameter_list|)
block|{
name|LOG
operator|.
name|log
argument_list|(
name|Level
operator|.
name|INFO
argument_list|,
literal|"PropertyException setting Marshaller properties"
argument_list|,
name|pe
argument_list|)
expr_stmt|;
block|}
block|}
block|}
return|return
name|jm
return|;
block|}
annotation|@
name|SuppressWarnings
argument_list|(
literal|"unchecked"
argument_list|)
specifier|public
specifier|static
name|void
name|marshall
parameter_list|(
name|JAXBContext
name|context
parameter_list|,
name|Schema
name|schema
parameter_list|,
name|Object
name|elValue
parameter_list|,
name|MessagePartInfo
name|part
parameter_list|,
name|Object
name|source
parameter_list|,
name|AttachmentMarshaller
name|am
parameter_list|,
name|Map
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|marshallerProperties
parameter_list|)
block|{
name|Class
argument_list|<
name|?
argument_list|>
name|cls
init|=
literal|null
decl_stmt|;
if|if
condition|(
name|part
operator|!=
literal|null
condition|)
block|{
name|cls
operator|=
name|part
operator|.
name|getTypeClass
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|cls
operator|==
literal|null
condition|)
block|{
name|cls
operator|=
literal|null
operator|!=
name|elValue
condition|?
name|elValue
operator|.
name|getClass
argument_list|()
else|:
literal|null
expr_stmt|;
block|}
if|if
condition|(
name|cls
operator|!=
literal|null
operator|&&
name|cls
operator|.
name|isArray
argument_list|()
operator|&&
name|elValue
operator|instanceof
name|Collection
condition|)
block|{
name|Collection
argument_list|<
name|?
argument_list|>
name|col
init|=
operator|(
name|Collection
argument_list|<
name|?
argument_list|>
operator|)
name|elValue
decl_stmt|;
name|elValue
operator|=
name|col
operator|.
name|toArray
argument_list|(
operator|(
name|Object
index|[]
operator|)
name|Array
operator|.
name|newInstance
argument_list|(
name|cls
operator|.
name|getComponentType
argument_list|()
argument_list|,
name|col
operator|.
name|size
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
try|try
block|{
name|Marshaller
name|u
init|=
name|createMarshaller
argument_list|(
name|context
argument_list|,
name|cls
argument_list|,
name|marshallerProperties
argument_list|)
decl_stmt|;
try|try
block|{
comment|// The Marshaller.JAXB_FRAGMENT will tell the Marshaller not to
comment|// generate the xml declaration.
name|u
operator|.
name|setProperty
argument_list|(
name|Marshaller
operator|.
name|JAXB_FRAGMENT
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|u
operator|.
name|setProperty
argument_list|(
name|Marshaller
operator|.
name|JAXB_FORMATTED_OUTPUT
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|PropertyException
name|e
parameter_list|)
block|{
comment|// intentionally empty.
block|}
name|Object
name|mObj
init|=
name|elValue
decl_stmt|;
name|QName
name|elName
init|=
literal|null
decl_stmt|;
if|if
condition|(
name|part
operator|!=
literal|null
condition|)
block|{
name|elName
operator|=
name|part
operator|.
name|getConcreteName
argument_list|()
expr_stmt|;
block|}
name|u
operator|.
name|setSchema
argument_list|(
name|schema
argument_list|)
expr_stmt|;
if|if
condition|(
name|am
operator|!=
literal|null
condition|)
block|{
name|u
operator|.
name|setAttachmentMarshaller
argument_list|(
name|am
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
literal|null
operator|!=
name|elName
condition|)
block|{
if|if
condition|(
name|part
operator|!=
literal|null
operator|&&
name|part
operator|.
name|getXmlSchema
argument_list|()
operator|instanceof
name|XmlSchemaElement
condition|)
block|{
name|XmlSchemaElement
name|el
init|=
operator|(
name|XmlSchemaElement
operator|)
name|part
operator|.
name|getXmlSchema
argument_list|()
decl_stmt|;
if|if
condition|(
name|mObj
operator|.
name|getClass
argument_list|()
operator|.
name|isArray
argument_list|()
operator|&&
name|el
operator|.
name|getSchemaType
argument_list|()
operator|instanceof
name|XmlSchemaSimpleType
operator|&&
operator|(
operator|(
name|XmlSchemaSimpleType
operator|)
name|el
operator|.
name|getSchemaType
argument_list|()
operator|)
operator|.
name|getContent
argument_list|()
operator|instanceof
name|XmlSchemaSimpleTypeList
condition|)
block|{
name|mObj
operator|=
name|Arrays
operator|.
name|asList
argument_list|(
operator|(
name|Object
index|[]
operator|)
name|mObj
argument_list|)
expr_stmt|;
name|writeObject
argument_list|(
name|u
argument_list|,
name|source
argument_list|,
operator|new
name|JAXBElement
argument_list|(
name|elName
argument_list|,
name|cls
argument_list|,
name|mObj
argument_list|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|part
operator|.
name|getMessageInfo
argument_list|()
operator|.
name|getOperation
argument_list|()
operator|.
name|isUnwrapped
argument_list|()
operator|&&
operator|(
name|mObj
operator|.
name|getClass
argument_list|()
operator|.
name|isArray
argument_list|()
operator|||
name|mObj
operator|instanceof
name|List
operator|)
operator|&&
name|el
operator|.
name|getMaxOccurs
argument_list|()
operator|!=
literal|1
condition|)
block|{
comment|// Have to handle this ourselves.... which really
comment|// sucks.... but what can we do?
name|Object
name|objArray
decl_stmt|;
if|if
condition|(
name|mObj
operator|instanceof
name|List
condition|)
block|{
name|List
name|l
init|=
operator|(
name|List
operator|)
name|mObj
decl_stmt|;
name|objArray
operator|=
name|l
operator|.
name|toArray
argument_list|(
operator|new
name|Object
index|[
name|l
operator|.
name|size
argument_list|()
index|]
argument_list|)
expr_stmt|;
name|cls
operator|=
literal|null
expr_stmt|;
block|}
else|else
block|{
name|objArray
operator|=
name|mObj
expr_stmt|;
name|cls
operator|=
name|objArray
operator|.
name|getClass
argument_list|()
operator|.
name|getComponentType
argument_list|()
expr_stmt|;
block|}
name|int
name|len
init|=
name|Array
operator|.
name|getLength
argument_list|(
name|objArray
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|x
init|=
literal|0
init|;
name|x
operator|<
name|len
condition|;
name|x
operator|++
control|)
block|{
name|Object
name|o
init|=
name|Array
operator|.
name|get
argument_list|(
name|objArray
argument_list|,
name|x
argument_list|)
decl_stmt|;
name|writeObject
argument_list|(
name|u
argument_list|,
name|source
argument_list|,
operator|new
name|JAXBElement
argument_list|(
name|elName
argument_list|,
name|cls
operator|==
literal|null
condition|?
name|o
operator|.
name|getClass
argument_list|()
else|:
name|cls
argument_list|,
name|o
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|writeObject
argument_list|(
name|u
argument_list|,
name|source
argument_list|,
operator|new
name|JAXBElement
argument_list|(
name|elName
argument_list|,
name|cls
argument_list|,
name|mObj
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|byte
index|[]
operator|.
name|class
operator|==
name|cls
operator|&&
name|part
operator|.
name|getTypeQName
argument_list|()
operator|!=
literal|null
operator|&&
name|part
operator|.
name|getTypeQName
argument_list|()
operator|.
name|getLocalPart
argument_list|()
operator|.
name|equals
argument_list|(
literal|"hexBinary"
argument_list|)
condition|)
block|{
name|mObj
operator|=
operator|new
name|HexBinaryAdapter
argument_list|()
operator|.
name|marshal
argument_list|(
operator|(
name|byte
index|[]
operator|)
name|mObj
argument_list|)
expr_stmt|;
name|writeObject
argument_list|(
name|u
argument_list|,
name|source
argument_list|,
operator|new
name|JAXBElement
argument_list|(
name|elName
argument_list|,
name|String
operator|.
name|class
argument_list|,
name|mObj
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|writeObject
argument_list|(
name|u
argument_list|,
name|source
argument_list|,
operator|new
name|JAXBElement
argument_list|(
name|elName
argument_list|,
name|cls
argument_list|,
name|mObj
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|writeObject
argument_list|(
name|u
argument_list|,
name|source
argument_list|,
name|mObj
argument_list|)
expr_stmt|;
block|}
block|}
catch|catch
parameter_list|(
name|Fault
name|ex
parameter_list|)
block|{
throw|throw
operator|(
name|Fault
operator|)
name|ex
operator|.
name|fillInStackTrace
argument_list|()
throw|;
block|}
catch|catch
parameter_list|(
name|Exception
name|ex
parameter_list|)
block|{
if|if
condition|(
name|ex
operator|instanceof
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|MarshalException
condition|)
block|{
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|MarshalException
name|marshalEx
init|=
operator|(
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|MarshalException
operator|)
name|ex
decl_stmt|;
name|Message
name|faultMessage
init|=
operator|new
name|Message
argument_list|(
literal|"MARSHAL_ERROR"
argument_list|,
name|BUNDLE
argument_list|,
name|marshalEx
operator|.
name|getLinkedException
argument_list|()
operator|.
name|getMessage
argument_list|()
argument_list|)
decl_stmt|;
throw|throw
operator|new
name|Fault
argument_list|(
name|faultMessage
argument_list|,
name|ex
argument_list|)
throw|;
block|}
else|else
block|{
throw|throw
operator|new
name|Fault
argument_list|(
operator|new
name|Message
argument_list|(
literal|"MARSHAL_ERROR"
argument_list|,
name|BUNDLE
argument_list|,
name|ex
operator|.
name|getMessage
argument_list|()
argument_list|)
argument_list|,
name|ex
argument_list|)
throw|;
block|}
block|}
block|}
comment|//TODO: cache the JAXBRIContext
annotation|@
name|SuppressWarnings
argument_list|(
literal|"unchecked"
argument_list|)
specifier|public
specifier|static
name|void
name|marshalWithBridge
parameter_list|(
name|TypeReference
name|ref
parameter_list|,
name|Set
argument_list|<
name|Class
argument_list|<
name|?
argument_list|>
argument_list|>
name|ctxClasses
parameter_list|,
name|Object
name|elValue
parameter_list|,
name|Object
name|source
parameter_list|,
name|AttachmentMarshaller
name|am
parameter_list|)
block|{
name|List
argument_list|<
name|TypeReference
argument_list|>
name|typeRefs
init|=
operator|new
name|ArrayList
argument_list|<
name|TypeReference
argument_list|>
argument_list|()
decl_stmt|;
name|typeRefs
operator|.
name|add
argument_list|(
name|ref
argument_list|)
expr_stmt|;
name|List
argument_list|<
name|Class
argument_list|<
name|?
argument_list|>
argument_list|>
name|clses
init|=
operator|new
name|ArrayList
argument_list|<
name|Class
argument_list|<
name|?
argument_list|>
argument_list|>
argument_list|(
name|ctxClasses
argument_list|)
decl_stmt|;
name|clses
operator|.
name|add
argument_list|(
name|ref
operator|.
name|type
operator|.
name|getClass
argument_list|()
argument_list|)
expr_stmt|;
try|try
block|{
name|JAXBRIContext
name|riContext
init|=
name|JAXBRIContext
operator|.
name|newInstance
argument_list|(
name|clses
operator|.
name|toArray
argument_list|(
operator|new
name|Class
index|[
name|clses
operator|.
name|size
argument_list|()
index|]
argument_list|)
argument_list|,
name|typeRefs
argument_list|,
literal|null
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|,
literal|null
argument_list|)
decl_stmt|;
name|Bridge
name|bridge
init|=
name|riContext
operator|.
name|createBridge
argument_list|(
name|ref
argument_list|)
decl_stmt|;
if|if
condition|(
name|source
operator|instanceof
name|XMLStreamWriter
condition|)
block|{
name|bridge
operator|.
name|marshal
argument_list|(
name|elValue
argument_list|,
operator|(
name|XMLStreamWriter
operator|)
name|source
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|source
operator|instanceof
name|OutputStream
condition|)
block|{
comment|//the namespace is missing when marshal the xsd:QName type
comment|//to the OutputStream directly
name|java
operator|.
name|io
operator|.
name|StringWriter
name|sw
init|=
operator|new
name|java
operator|.
name|io
operator|.
name|StringWriter
argument_list|()
decl_stmt|;
name|StreamResult
name|s1
init|=
operator|new
name|StreamResult
argument_list|(
name|sw
argument_list|)
decl_stmt|;
name|bridge
operator|.
name|marshal
argument_list|(
name|elValue
argument_list|,
name|s1
argument_list|)
expr_stmt|;
operator|(
operator|(
name|OutputStream
operator|)
name|source
operator|)
operator|.
name|write
argument_list|(
name|sw
operator|.
name|toString
argument_list|()
operator|.
name|getBytes
argument_list|()
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|source
operator|instanceof
name|Node
condition|)
block|{
name|bridge
operator|.
name|marshal
argument_list|(
name|elValue
argument_list|,
operator|(
name|Node
operator|)
name|source
argument_list|)
expr_stmt|;
block|}
else|else
block|{
throw|throw
operator|new
name|Fault
argument_list|(
operator|new
name|Message
argument_list|(
literal|"UNKNOWN_SOURCE"
argument_list|,
name|BUNDLE
argument_list|,
name|source
operator|.
name|getClass
argument_list|()
operator|.
name|getName
argument_list|()
argument_list|)
argument_list|)
throw|;
block|}
block|}
catch|catch
parameter_list|(
name|Exception
name|ex
parameter_list|)
block|{
name|ex
operator|.
name|printStackTrace
argument_list|()
expr_stmt|;
if|if
condition|(
name|ex
operator|instanceof
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|MarshalException
condition|)
block|{
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|MarshalException
name|marshalEx
init|=
operator|(
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|MarshalException
operator|)
name|ex
decl_stmt|;
name|Message
name|faultMessage
init|=
operator|new
name|Message
argument_list|(
literal|"MARSHAL_ERROR"
argument_list|,
name|BUNDLE
argument_list|,
name|marshalEx
operator|.
name|getLinkedException
argument_list|()
operator|.
name|getMessage
argument_list|()
argument_list|)
decl_stmt|;
throw|throw
operator|new
name|Fault
argument_list|(
name|faultMessage
argument_list|,
name|ex
argument_list|)
throw|;
block|}
else|else
block|{
throw|throw
operator|new
name|Fault
argument_list|(
operator|new
name|Message
argument_list|(
literal|"MARSHAL_ERROR"
argument_list|,
name|BUNDLE
argument_list|,
name|ex
operator|.
name|getMessage
argument_list|()
argument_list|)
argument_list|,
name|ex
argument_list|)
throw|;
block|}
block|}
block|}
comment|//  TODO: cache the JAXBRIContext
annotation|@
name|SuppressWarnings
argument_list|(
literal|"unchecked"
argument_list|)
specifier|public
specifier|static
name|Object
name|unmarshalWithBridge
parameter_list|(
name|TypeReference
name|ref
parameter_list|,
name|Set
argument_list|<
name|Class
argument_list|<
name|?
argument_list|>
argument_list|>
name|ctxClasses
parameter_list|,
name|Object
name|source
parameter_list|,
name|AttachmentUnmarshaller
name|am
parameter_list|)
block|{
name|List
argument_list|<
name|TypeReference
argument_list|>
name|typeRefs
init|=
operator|new
name|ArrayList
argument_list|<
name|TypeReference
argument_list|>
argument_list|()
decl_stmt|;
name|typeRefs
operator|.
name|add
argument_list|(
name|ref
argument_list|)
expr_stmt|;
name|List
argument_list|<
name|Class
argument_list|<
name|?
argument_list|>
argument_list|>
name|clses
init|=
operator|new
name|ArrayList
argument_list|<
name|Class
argument_list|<
name|?
argument_list|>
argument_list|>
argument_list|(
name|ctxClasses
argument_list|)
decl_stmt|;
name|clses
operator|.
name|add
argument_list|(
name|ref
operator|.
name|type
operator|.
name|getClass
argument_list|()
argument_list|)
expr_stmt|;
try|try
block|{
name|JAXBRIContext
name|riContext
init|=
name|JAXBRIContext
operator|.
name|newInstance
argument_list|(
name|clses
operator|.
name|toArray
argument_list|(
operator|new
name|Class
index|[
name|clses
operator|.
name|size
argument_list|()
index|]
argument_list|)
argument_list|,
name|typeRefs
argument_list|,
literal|null
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|,
literal|null
argument_list|)
decl_stmt|;
name|Bridge
name|bridge
init|=
name|riContext
operator|.
name|createBridge
argument_list|(
name|ref
argument_list|)
decl_stmt|;
if|if
condition|(
name|source
operator|instanceof
name|XMLStreamReader
condition|)
block|{
comment|//DOMUtils.writeXml(StaxUtils.read((XMLStreamReader)source), System.out);
return|return
name|bridge
operator|.
name|unmarshal
argument_list|(
operator|(
name|XMLStreamReader
operator|)
name|source
argument_list|)
return|;
block|}
elseif|else
if|if
condition|(
name|source
operator|instanceof
name|InputStream
condition|)
block|{
return|return
name|bridge
operator|.
name|unmarshal
argument_list|(
operator|(
name|InputStream
operator|)
name|source
argument_list|)
return|;
block|}
elseif|else
if|if
condition|(
name|source
operator|instanceof
name|Node
condition|)
block|{
return|return
name|bridge
operator|.
name|unmarshal
argument_list|(
operator|(
name|Node
operator|)
name|source
argument_list|,
name|am
argument_list|)
return|;
block|}
else|else
block|{
throw|throw
operator|new
name|Fault
argument_list|(
operator|new
name|Message
argument_list|(
literal|"UNKNOWN_SOURCE"
argument_list|,
name|BUNDLE
argument_list|,
name|source
operator|.
name|getClass
argument_list|()
operator|.
name|getName
argument_list|()
argument_list|)
argument_list|)
throw|;
block|}
block|}
catch|catch
parameter_list|(
name|Exception
name|ex
parameter_list|)
block|{
if|if
condition|(
name|ex
operator|instanceof
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|MarshalException
condition|)
block|{
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|MarshalException
name|marshalEx
init|=
operator|(
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|MarshalException
operator|)
name|ex
decl_stmt|;
name|Message
name|faultMessage
init|=
operator|new
name|Message
argument_list|(
literal|"MARSHAL_ERROR"
argument_list|,
name|BUNDLE
argument_list|,
name|marshalEx
operator|.
name|getLinkedException
argument_list|()
operator|.
name|getMessage
argument_list|()
argument_list|)
decl_stmt|;
throw|throw
operator|new
name|Fault
argument_list|(
name|faultMessage
argument_list|,
name|ex
argument_list|)
throw|;
block|}
else|else
block|{
throw|throw
operator|new
name|Fault
argument_list|(
operator|new
name|Message
argument_list|(
literal|"MARSHAL_ERROR"
argument_list|,
name|BUNDLE
argument_list|,
name|ex
operator|.
name|getMessage
argument_list|()
argument_list|)
argument_list|,
name|ex
argument_list|)
throw|;
block|}
block|}
block|}
annotation|@
name|SuppressWarnings
argument_list|(
literal|"unchecked"
argument_list|)
specifier|public
specifier|static
name|void
name|marshallException
parameter_list|(
name|JAXBContext
name|context
parameter_list|,
name|Schema
name|schema
parameter_list|,
name|Exception
name|elValue
parameter_list|,
name|MessagePartInfo
name|part
parameter_list|,
name|Object
name|source
parameter_list|,
name|AttachmentMarshaller
name|am
parameter_list|,
name|Map
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|marshallerProperties
parameter_list|)
block|{
name|XMLStreamWriter
name|writer
init|=
name|getStreamWriter
argument_list|(
name|source
argument_list|)
decl_stmt|;
name|QName
name|qn
init|=
name|part
operator|.
name|getElementQName
argument_list|()
decl_stmt|;
try|try
block|{
name|writer
operator|.
name|writeStartElement
argument_list|(
literal|"ns1"
argument_list|,
name|qn
operator|.
name|getLocalPart
argument_list|()
argument_list|,
name|qn
operator|.
name|getNamespaceURI
argument_list|()
argument_list|)
expr_stmt|;
name|Class
argument_list|<
name|?
argument_list|>
name|cls
init|=
name|part
operator|.
name|getTypeClass
argument_list|()
decl_stmt|;
name|XmlAccessorType
name|accessorType
init|=
name|cls
operator|.
name|getAnnotation
argument_list|(
name|XmlAccessorType
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|accessorType
operator|==
literal|null
operator|&&
name|cls
operator|.
name|getPackage
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|accessorType
operator|=
name|cls
operator|.
name|getPackage
argument_list|()
operator|.
name|getAnnotation
argument_list|(
name|XmlAccessorType
operator|.
name|class
argument_list|)
expr_stmt|;
block|}
name|XmlAccessType
name|accessType
init|=
name|accessorType
operator|!=
literal|null
condition|?
name|accessorType
operator|.
name|value
argument_list|()
else|:
name|XmlAccessType
operator|.
name|PUBLIC_MEMBER
decl_stmt|;
name|String
name|namespace
init|=
name|part
operator|.
name|getElementQName
argument_list|()
operator|.
name|getNamespaceURI
argument_list|()
decl_stmt|;
name|SchemaInfo
name|sch
init|=
name|part
operator|.
name|getMessageInfo
argument_list|()
operator|.
name|getOperation
argument_list|()
operator|.
name|getInterface
argument_list|()
operator|.
name|getService
argument_list|()
operator|.
name|getSchema
argument_list|(
name|namespace
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|sch
operator|.
name|isElementFormQualified
argument_list|()
condition|)
block|{
name|namespace
operator|=
literal|null
expr_stmt|;
block|}
name|Marshaller
name|u
init|=
name|createMarshaller
argument_list|(
name|context
argument_list|,
name|cls
argument_list|,
name|marshallerProperties
argument_list|)
decl_stmt|;
try|try
block|{
comment|// override anything the user asked us to set.
comment|// The Marshaller.JAXB_FRAGMENT will tell the Marshaller not to
comment|// generate the xml declaration.
name|u
operator|.
name|setProperty
argument_list|(
name|Marshaller
operator|.
name|JAXB_FRAGMENT
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|u
operator|.
name|setProperty
argument_list|(
name|Marshaller
operator|.
name|JAXB_FORMATTED_OUTPUT
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|PropertyException
name|e
parameter_list|)
block|{
comment|// intentionally empty.
block|}
for|for
control|(
name|Field
name|f
range|:
name|cls
operator|.
name|getDeclaredFields
argument_list|()
control|)
block|{
if|if
condition|(
name|JAXBContextInitializer
operator|.
name|isFieldAccepted
argument_list|(
name|f
argument_list|,
name|accessType
argument_list|)
condition|)
block|{
name|QName
name|fname
init|=
operator|new
name|QName
argument_list|(
name|namespace
argument_list|,
name|f
operator|.
name|getName
argument_list|()
argument_list|)
decl_stmt|;
name|f
operator|.
name|setAccessible
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|writeObject
argument_list|(
name|u
argument_list|,
name|writer
argument_list|,
operator|new
name|JAXBElement
argument_list|(
name|fname
argument_list|,
name|String
operator|.
name|class
argument_list|,
name|f
operator|.
name|get
argument_list|(
name|elValue
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
for|for
control|(
name|Method
name|m
range|:
name|cls
operator|.
name|getMethods
argument_list|()
control|)
block|{
if|if
condition|(
name|JAXBContextInitializer
operator|.
name|isMethodAccepted
argument_list|(
name|m
argument_list|,
name|accessType
argument_list|)
condition|)
block|{
name|int
name|idx
init|=
name|m
operator|.
name|getName
argument_list|()
operator|.
name|startsWith
argument_list|(
literal|"get"
argument_list|)
condition|?
literal|3
else|:
literal|2
decl_stmt|;
name|String
name|name
init|=
name|m
operator|.
name|getName
argument_list|()
operator|.
name|substring
argument_list|(
name|idx
argument_list|)
decl_stmt|;
name|name
operator|=
name|Character
operator|.
name|toLowerCase
argument_list|(
name|name
operator|.
name|charAt
argument_list|(
literal|0
argument_list|)
argument_list|)
operator|+
name|name
operator|.
name|substring
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|QName
name|mname
init|=
operator|new
name|QName
argument_list|(
name|namespace
argument_list|,
name|name
argument_list|)
decl_stmt|;
name|writeObject
argument_list|(
name|u
argument_list|,
name|writer
argument_list|,
operator|new
name|JAXBElement
argument_list|(
name|mname
argument_list|,
name|String
operator|.
name|class
argument_list|,
name|m
operator|.
name|invoke
argument_list|(
name|elValue
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
name|writer
operator|.
name|writeEndElement
argument_list|()
expr_stmt|;
name|writer
operator|.
name|flush
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|Fault
argument_list|(
operator|new
name|Message
argument_list|(
literal|"MARSHAL_ERROR"
argument_list|,
name|BUNDLE
argument_list|,
name|e
operator|.
name|getMessage
argument_list|()
argument_list|)
argument_list|,
name|e
argument_list|)
throw|;
block|}
block|}
annotation|@
name|SuppressWarnings
argument_list|(
literal|"unchecked"
argument_list|)
specifier|public
specifier|static
name|Exception
name|unmarshallException
parameter_list|(
name|JAXBContext
name|context
parameter_list|,
name|Schema
name|schema
parameter_list|,
name|Object
name|source
parameter_list|,
name|MessagePartInfo
name|part
parameter_list|,
name|AttachmentUnmarshaller
name|au
parameter_list|)
block|{
name|XMLStreamReader
name|reader
decl_stmt|;
if|if
condition|(
name|source
operator|instanceof
name|XMLStreamReader
condition|)
block|{
name|reader
operator|=
operator|(
name|XMLStreamReader
operator|)
name|source
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|source
operator|instanceof
name|Element
condition|)
block|{
name|reader
operator|=
name|StaxUtils
operator|.
name|createXMLStreamReader
argument_list|(
operator|(
name|Element
operator|)
name|source
argument_list|)
expr_stmt|;
try|try
block|{
comment|// advance into the node
name|reader
operator|.
name|nextTag
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|XMLStreamException
name|e
parameter_list|)
block|{
comment|// ignore
block|}
block|}
else|else
block|{
throw|throw
operator|new
name|Fault
argument_list|(
operator|new
name|Message
argument_list|(
literal|"UNKNOWN_SOURCE"
argument_list|,
name|BUNDLE
argument_list|,
name|source
operator|.
name|getClass
argument_list|()
operator|.
name|getName
argument_list|()
argument_list|)
argument_list|)
throw|;
block|}
try|try
block|{
name|QName
name|qn
init|=
name|part
operator|.
name|getElementQName
argument_list|()
decl_stmt|;
if|if
condition|(
operator|!
name|qn
operator|.
name|equals
argument_list|(
name|reader
operator|.
name|getName
argument_list|()
argument_list|)
condition|)
block|{
throw|throw
operator|new
name|Fault
argument_list|(
operator|new
name|Message
argument_list|(
literal|"ELEMENT_NAME_MISMATCH"
argument_list|,
name|BUNDLE
argument_list|,
name|qn
argument_list|,
name|reader
operator|.
name|getName
argument_list|()
argument_list|)
argument_list|)
throw|;
block|}
name|Class
argument_list|<
name|?
argument_list|>
name|cls
init|=
name|part
operator|.
name|getTypeClass
argument_list|()
decl_stmt|;
name|Object
name|obj
init|=
literal|null
decl_stmt|;
try|try
block|{
name|Constructor
name|cons
init|=
name|cls
operator|.
name|getConstructor
argument_list|()
decl_stmt|;
name|obj
operator|=
name|cons
operator|.
name|newInstance
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|NoSuchMethodException
name|nse
parameter_list|)
block|{
name|Constructor
name|cons
init|=
name|cls
operator|.
name|getConstructor
argument_list|(
operator|new
name|Class
index|[]
block|{
name|String
operator|.
name|class
block|}
argument_list|)
decl_stmt|;
name|obj
operator|=
name|cons
operator|.
name|newInstance
argument_list|(
operator|new
name|Object
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
name|XmlAccessorType
name|accessorType
init|=
name|cls
operator|.
name|getAnnotation
argument_list|(
name|XmlAccessorType
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|accessorType
operator|==
literal|null
operator|&&
name|cls
operator|.
name|getPackage
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|accessorType
operator|=
name|cls
operator|.
name|getPackage
argument_list|()
operator|.
name|getAnnotation
argument_list|(
name|XmlAccessorType
operator|.
name|class
argument_list|)
expr_stmt|;
block|}
name|XmlAccessType
name|accessType
init|=
name|accessorType
operator|!=
literal|null
condition|?
name|accessorType
operator|.
name|value
argument_list|()
else|:
name|XmlAccessType
operator|.
name|PUBLIC_MEMBER
decl_stmt|;
name|Unmarshaller
name|u
init|=
name|createUnmarshaller
argument_list|(
name|context
argument_list|,
name|cls
argument_list|)
decl_stmt|;
try|try
block|{
comment|// The Marshaller.JAXB_FRAGMENT will tell the Marshaller not to
comment|// generate the xml declaration.
name|u
operator|.
name|setProperty
argument_list|(
name|Marshaller
operator|.
name|JAXB_FRAGMENT
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|u
operator|.
name|setProperty
argument_list|(
name|Marshaller
operator|.
name|JAXB_FORMATTED_OUTPUT
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|PropertyException
name|e
parameter_list|)
block|{
comment|// intentionally empty.
block|}
name|reader
operator|.
name|nextTag
argument_list|()
expr_stmt|;
while|while
condition|(
name|reader
operator|.
name|getEventType
argument_list|()
operator|==
name|XMLStreamReader
operator|.
name|START_ELEMENT
condition|)
block|{
name|QName
name|q
init|=
name|reader
operator|.
name|getName
argument_list|()
decl_stmt|;
try|try
block|{
name|Field
name|f
init|=
name|cls
operator|.
name|getField
argument_list|(
name|q
operator|.
name|getLocalPart
argument_list|()
argument_list|)
decl_stmt|;
if|if
condition|(
name|JAXBContextInitializer
operator|.
name|isFieldAccepted
argument_list|(
name|f
argument_list|,
name|accessType
argument_list|)
condition|)
block|{
name|f
operator|.
name|setAccessible
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|f
operator|.
name|set
argument_list|(
name|obj
argument_list|,
name|u
operator|.
name|unmarshal
argument_list|(
name|reader
argument_list|,
name|f
operator|.
name|getType
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
catch|catch
parameter_list|(
name|NoSuchFieldException
name|ex
parameter_list|)
block|{
name|String
name|s
init|=
name|Character
operator|.
name|toUpperCase
argument_list|(
name|q
operator|.
name|getLocalPart
argument_list|()
operator|.
name|charAt
argument_list|(
literal|0
argument_list|)
argument_list|)
operator|+
name|q
operator|.
name|getLocalPart
argument_list|()
operator|.
name|substring
argument_list|(
literal|1
argument_list|)
decl_stmt|;
name|Method
name|m
init|=
literal|null
decl_stmt|;
try|try
block|{
name|m
operator|=
name|cls
operator|.
name|getMethod
argument_list|(
literal|"get"
operator|+
name|s
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|NoSuchMethodException
name|mex
parameter_list|)
block|{
name|m
operator|=
name|cls
operator|.
name|getMethod
argument_list|(
literal|"is"
operator|+
name|s
argument_list|)
expr_stmt|;
block|}
name|Method
name|m2
init|=
name|cls
operator|.
name|getMethod
argument_list|(
literal|"set"
operator|+
name|s
argument_list|,
name|m
operator|.
name|getReturnType
argument_list|()
argument_list|)
decl_stmt|;
name|Object
name|o
init|=
name|getElementValue
argument_list|(
name|u
operator|.
name|unmarshal
argument_list|(
name|reader
argument_list|,
name|m
operator|.
name|getReturnType
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|m2
operator|.
name|invoke
argument_list|(
name|obj
argument_list|,
name|o
argument_list|)
expr_stmt|;
block|}
block|}
return|return
operator|(
name|Exception
operator|)
name|obj
return|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|Fault
argument_list|(
operator|new
name|Message
argument_list|(
literal|"MARSHAL_ERROR"
argument_list|,
name|BUNDLE
argument_list|,
name|e
operator|.
name|getMessage
argument_list|()
argument_list|)
argument_list|,
name|e
argument_list|)
throw|;
block|}
block|}
specifier|private
specifier|static
name|void
name|writeObject
parameter_list|(
name|Marshaller
name|u
parameter_list|,
name|Object
name|source
parameter_list|,
name|Object
name|mObj
parameter_list|)
throws|throws
name|Fault
throws|,
name|JAXBException
block|{
if|if
condition|(
name|source
operator|instanceof
name|XMLStreamWriter
condition|)
block|{
name|u
operator|.
name|marshal
argument_list|(
name|mObj
argument_list|,
operator|(
name|XMLStreamWriter
operator|)
name|source
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|source
operator|instanceof
name|OutputStream
condition|)
block|{
name|u
operator|.
name|marshal
argument_list|(
name|mObj
argument_list|,
operator|(
name|OutputStream
operator|)
name|source
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|source
operator|instanceof
name|Node
condition|)
block|{
name|u
operator|.
name|marshal
argument_list|(
name|mObj
argument_list|,
operator|(
name|Node
operator|)
name|source
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|source
operator|instanceof
name|XMLEventWriter
condition|)
block|{
name|u
operator|.
name|marshal
argument_list|(
name|mObj
argument_list|,
operator|(
name|XMLEventWriter
operator|)
name|source
argument_list|)
expr_stmt|;
block|}
else|else
block|{
throw|throw
operator|new
name|Fault
argument_list|(
operator|new
name|Message
argument_list|(
literal|"UNKNOWN_SOURCE"
argument_list|,
name|BUNDLE
argument_list|,
name|source
operator|.
name|getClass
argument_list|()
operator|.
name|getName
argument_list|()
argument_list|)
argument_list|)
throw|;
block|}
block|}
specifier|private
specifier|static
name|XMLStreamWriter
name|getStreamWriter
parameter_list|(
name|Object
name|source
parameter_list|)
throws|throws
name|Fault
block|{
if|if
condition|(
name|source
operator|instanceof
name|XMLStreamWriter
condition|)
block|{
return|return
operator|(
name|XMLStreamWriter
operator|)
name|source
return|;
block|}
elseif|else
if|if
condition|(
name|source
operator|instanceof
name|OutputStream
condition|)
block|{
return|return
name|StaxUtils
operator|.
name|createXMLStreamWriter
argument_list|(
operator|(
name|OutputStream
operator|)
name|source
argument_list|)
return|;
block|}
elseif|else
if|if
condition|(
name|source
operator|instanceof
name|Node
condition|)
block|{
return|return
operator|new
name|W3CDOMStreamWriter
argument_list|(
operator|(
name|Element
operator|)
name|source
argument_list|)
return|;
block|}
throw|throw
operator|new
name|Fault
argument_list|(
operator|new
name|Message
argument_list|(
literal|"UNKNOWN_SOURCE"
argument_list|,
name|BUNDLE
argument_list|,
name|source
operator|.
name|getClass
argument_list|()
operator|.
name|getName
argument_list|()
argument_list|)
argument_list|)
throw|;
block|}
specifier|public
specifier|static
name|void
name|marshall
parameter_list|(
name|JAXBContext
name|context
parameter_list|,
name|Schema
name|schema
parameter_list|,
name|Object
name|elValue
parameter_list|,
name|Object
name|source
parameter_list|,
name|Map
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|marshallerProperties
parameter_list|)
block|{
name|marshall
argument_list|(
name|context
argument_list|,
name|schema
argument_list|,
name|elValue
argument_list|,
literal|null
argument_list|,
name|source
argument_list|,
literal|null
argument_list|,
name|marshallerProperties
argument_list|)
expr_stmt|;
block|}
annotation|@
name|SuppressWarnings
argument_list|(
literal|"unchecked"
argument_list|)
specifier|public
specifier|static
name|void
name|marshallNullElement
parameter_list|(
name|JAXBContext
name|context
parameter_list|,
name|Schema
name|schema
parameter_list|,
name|Object
name|source
parameter_list|,
name|MessagePartInfo
name|part
parameter_list|,
name|Map
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|marshallerProperties
parameter_list|)
block|{
name|Class
argument_list|<
name|?
argument_list|>
name|clazz
init|=
name|part
operator|!=
literal|null
condition|?
operator|(
name|Class
operator|)
name|part
operator|.
name|getTypeClass
argument_list|()
else|:
literal|null
decl_stmt|;
try|try
block|{
name|Marshaller
name|u
init|=
name|createMarshaller
argument_list|(
name|context
argument_list|,
name|clazz
argument_list|,
name|marshallerProperties
argument_list|)
decl_stmt|;
name|u
operator|.
name|setSchema
argument_list|(
name|schema
argument_list|)
expr_stmt|;
try|try
block|{
comment|// The Marshaller.JAXB_FRAGMENT will tell the Marshaller not to
comment|// generate the xml declaration.
name|u
operator|.
name|setProperty
argument_list|(
name|Marshaller
operator|.
name|JAXB_FRAGMENT
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|u
operator|.
name|setProperty
argument_list|(
name|Marshaller
operator|.
name|JAXB_FORMATTED_OUTPUT
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|PropertyException
name|e
parameter_list|)
block|{
comment|// intentionally empty.
block|}
name|writeObject
argument_list|(
name|u
argument_list|,
name|source
argument_list|,
operator|new
name|JAXBElement
argument_list|(
name|part
operator|.
name|getElementQName
argument_list|()
argument_list|,
name|clazz
argument_list|,
literal|null
argument_list|)
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|JAXBException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|Fault
argument_list|(
operator|new
name|Message
argument_list|(
literal|"MARSHAL_ERROR"
argument_list|,
name|BUNDLE
argument_list|,
name|e
operator|.
name|getMessage
argument_list|()
argument_list|)
argument_list|,
name|e
argument_list|)
throw|;
block|}
block|}
specifier|public
specifier|static
name|void
name|marshall
parameter_list|(
name|JAXBContext
name|context
parameter_list|,
name|Schema
name|schema
parameter_list|,
name|Object
name|elValue
parameter_list|,
name|MessagePartInfo
name|part
parameter_list|,
name|Object
name|source
parameter_list|,
name|Map
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|marshallerProperties
parameter_list|)
block|{
name|marshall
argument_list|(
name|context
argument_list|,
name|schema
argument_list|,
name|elValue
argument_list|,
name|part
argument_list|,
name|source
argument_list|,
literal|null
argument_list|,
name|marshallerProperties
argument_list|)
expr_stmt|;
block|}
specifier|private
specifier|static
name|Unmarshaller
name|createUnmarshaller
parameter_list|(
name|JAXBContext
name|context
parameter_list|,
name|Class
argument_list|<
name|?
argument_list|>
name|cls
parameter_list|)
throws|throws
name|JAXBException
block|{
name|Unmarshaller
name|um
init|=
literal|null
decl_stmt|;
if|if
condition|(
name|context
operator|==
literal|null
condition|)
block|{
if|if
condition|(
name|cls
operator|==
literal|null
condition|)
block|{
throw|throw
operator|new
name|IllegalStateException
argument_list|(
literal|"A JAXBContext or Class to unmarshal must be provided!"
argument_list|)
throw|;
block|}
name|context
operator|=
name|JAXBContext
operator|.
name|newInstance
argument_list|(
name|cls
argument_list|)
expr_stmt|;
block|}
name|um
operator|=
name|context
operator|.
name|createUnmarshaller
argument_list|()
expr_stmt|;
return|return
name|um
return|;
block|}
specifier|public
specifier|static
name|Object
name|unmarshall
parameter_list|(
name|JAXBContext
name|context
parameter_list|,
name|Schema
name|schema
parameter_list|,
name|Object
name|source
parameter_list|)
block|{
return|return
name|unmarshall
argument_list|(
name|context
argument_list|,
name|schema
argument_list|,
name|source
argument_list|,
literal|null
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|)
return|;
block|}
annotation|@
name|SuppressWarnings
argument_list|(
literal|"unchecked"
argument_list|)
specifier|public
specifier|static
name|Object
name|unmarshall
parameter_list|(
name|JAXBContext
name|context
parameter_list|,
name|Schema
name|schema
parameter_list|,
name|Object
name|source
parameter_list|,
name|MessagePartInfo
name|part
parameter_list|,
name|AttachmentUnmarshaller
name|au
parameter_list|,
name|boolean
name|unwrap
parameter_list|)
block|{
name|Class
argument_list|<
name|?
argument_list|>
name|clazz
init|=
name|part
operator|!=
literal|null
condition|?
operator|(
name|Class
operator|)
name|part
operator|.
name|getTypeClass
argument_list|()
else|:
literal|null
decl_stmt|;
if|if
condition|(
name|clazz
operator|!=
literal|null
operator|&&
name|Exception
operator|.
name|class
operator|.
name|isAssignableFrom
argument_list|(
name|clazz
argument_list|)
operator|&&
name|part
operator|!=
literal|null
operator|&&
name|Boolean
operator|.
name|TRUE
operator|.
name|equals
argument_list|(
name|part
operator|.
name|getProperty
argument_list|(
name|JAXBDataBinding
operator|.
name|class
operator|.
name|getName
argument_list|()
operator|+
literal|".CUSTOM_EXCEPTION"
argument_list|)
argument_list|)
condition|)
block|{
return|return
name|unmarshallException
argument_list|(
name|context
argument_list|,
name|schema
argument_list|,
name|source
argument_list|,
name|part
argument_list|,
name|au
argument_list|)
return|;
block|}
name|QName
name|elName
init|=
name|part
operator|!=
literal|null
condition|?
name|part
operator|.
name|getConcreteName
argument_list|()
else|:
literal|null
decl_stmt|;
if|if
condition|(
name|clazz
operator|!=
literal|null
operator|&&
name|clazz
operator|.
name|isArray
argument_list|()
operator|&&
name|part
operator|!=
literal|null
operator|&&
name|part
operator|.
name|getXmlSchema
argument_list|()
operator|instanceof
name|XmlSchemaElement
condition|)
block|{
name|XmlSchemaElement
name|el
init|=
operator|(
name|XmlSchemaElement
operator|)
name|part
operator|.
name|getXmlSchema
argument_list|()
decl_stmt|;
if|if
condition|(
name|el
operator|.
name|getSchemaType
argument_list|()
operator|instanceof
name|XmlSchemaSimpleType
operator|&&
operator|(
operator|(
name|XmlSchemaSimpleType
operator|)
name|el
operator|.
name|getSchemaType
argument_list|()
operator|)
operator|.
name|getContent
argument_list|()
operator|instanceof
name|XmlSchemaSimpleTypeList
condition|)
block|{
name|Object
name|obj
init|=
name|unmarshall
argument_list|(
name|context
argument_list|,
name|schema
argument_list|,
name|source
argument_list|,
name|elName
argument_list|,
literal|null
argument_list|,
name|au
argument_list|,
name|unwrap
argument_list|)
decl_stmt|;
if|if
condition|(
name|clazz
operator|.
name|isArray
argument_list|()
operator|&&
name|obj
operator|instanceof
name|List
condition|)
block|{
return|return
operator|(
operator|(
name|List
operator|)
name|obj
operator|)
operator|.
name|toArray
argument_list|(
operator|(
name|Object
index|[]
operator|)
name|Array
operator|.
name|newInstance
argument_list|(
name|clazz
operator|.
name|getComponentType
argument_list|()
argument_list|,
operator|(
operator|(
name|List
operator|)
name|obj
operator|)
operator|.
name|size
argument_list|()
argument_list|)
argument_list|)
return|;
block|}
return|return
name|obj
return|;
block|}
elseif|else
if|if
condition|(
name|part
operator|.
name|getMessageInfo
argument_list|()
operator|.
name|getOperation
argument_list|()
operator|.
name|isUnwrapped
argument_list|()
operator|&&
name|el
operator|.
name|getMaxOccurs
argument_list|()
operator|!=
literal|1
condition|)
block|{
comment|// must read ourselves....
name|List
argument_list|<
name|Object
argument_list|>
name|ret
init|=
name|unmarshallArray
argument_list|(
name|context
argument_list|,
name|schema
argument_list|,
name|source
argument_list|,
name|elName
argument_list|,
name|clazz
operator|.
name|getComponentType
argument_list|()
argument_list|,
name|au
argument_list|,
name|createList
argument_list|(
name|part
argument_list|)
argument_list|)
decl_stmt|;
name|Object
name|o
init|=
name|ret
decl_stmt|;
if|if
condition|(
operator|!
name|isList
argument_list|(
name|part
argument_list|)
condition|)
block|{
if|if
condition|(
name|clazz
operator|.
name|getComponentType
argument_list|()
operator|.
name|isPrimitive
argument_list|()
condition|)
block|{
name|o
operator|=
name|java
operator|.
name|lang
operator|.
name|reflect
operator|.
name|Array
operator|.
name|newInstance
argument_list|(
name|clazz
operator|.
name|getComponentType
argument_list|()
argument_list|,
name|ret
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|x
init|=
literal|0
init|;
name|x
operator|<
name|ret
operator|.
name|size
argument_list|()
condition|;
name|x
operator|++
control|)
block|{
name|Array
operator|.
name|set
argument_list|(
name|o
argument_list|,
name|x
argument_list|,
name|ret
operator|.
name|get
argument_list|(
name|x
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|o
operator|=
name|ret
operator|.
name|toArray
argument_list|(
operator|(
name|Object
index|[]
operator|)
name|Array
operator|.
name|newInstance
argument_list|(
name|clazz
operator|.
name|getComponentType
argument_list|()
argument_list|,
name|ret
operator|.
name|size
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|o
return|;
block|}
block|}
elseif|else
if|if
condition|(
name|byte
index|[]
operator|.
name|class
operator|==
name|clazz
operator|&&
name|part
operator|!=
literal|null
operator|&&
name|part
operator|.
name|getTypeQName
argument_list|()
operator|!=
literal|null
operator|&&
name|part
operator|.
name|getTypeQName
argument_list|()
operator|.
name|getLocalPart
argument_list|()
operator|.
name|equals
argument_list|(
literal|"hexBinary"
argument_list|)
condition|)
block|{
name|String
name|obj
init|=
operator|(
name|String
operator|)
name|unmarshall
argument_list|(
name|context
argument_list|,
name|schema
argument_list|,
name|source
argument_list|,
name|elName
argument_list|,
name|String
operator|.
name|class
argument_list|,
name|au
argument_list|,
name|unwrap
argument_list|)
decl_stmt|;
return|return
operator|new
name|HexBinaryAdapter
argument_list|()
operator|.
name|unmarshal
argument_list|(
name|obj
argument_list|)
return|;
block|}
name|Object
name|o
init|=
name|unmarshall
argument_list|(
name|context
argument_list|,
name|schema
argument_list|,
name|source
argument_list|,
name|elName
argument_list|,
name|clazz
argument_list|,
name|au
argument_list|,
name|unwrap
argument_list|)
decl_stmt|;
if|if
condition|(
name|o
operator|!=
literal|null
operator|&&
name|o
operator|.
name|getClass
argument_list|()
operator|.
name|isArray
argument_list|()
operator|&&
name|isList
argument_list|(
name|part
argument_list|)
condition|)
block|{
name|List
argument_list|<
name|Object
argument_list|>
name|ret
init|=
name|createList
argument_list|(
name|part
argument_list|)
decl_stmt|;
name|ret
operator|.
name|addAll
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
operator|(
name|Object
index|[]
operator|)
name|o
argument_list|)
argument_list|)
expr_stmt|;
name|o
operator|=
name|ret
expr_stmt|;
block|}
return|return
name|o
return|;
block|}
specifier|private
specifier|static
name|List
argument_list|<
name|Object
argument_list|>
name|createList
parameter_list|(
name|MessagePartInfo
name|part
parameter_list|)
block|{
name|Type
name|genericType
init|=
operator|(
name|Type
operator|)
name|part
operator|.
name|getProperty
argument_list|(
literal|"generic.type"
argument_list|)
decl_stmt|;
if|if
condition|(
name|genericType
operator|instanceof
name|ParameterizedType
condition|)
block|{
name|Type
name|tp2
init|=
operator|(
operator|(
name|ParameterizedType
operator|)
name|genericType
operator|)
operator|.
name|getRawType
argument_list|()
decl_stmt|;
if|if
condition|(
name|tp2
operator|instanceof
name|Class
condition|)
block|{
name|Class
argument_list|<
name|?
argument_list|>
name|cls
init|=
operator|(
name|Class
operator|)
name|tp2
decl_stmt|;
if|if
condition|(
operator|!
name|cls
operator|.
name|isInterface
argument_list|()
operator|&&
name|List
operator|.
name|class
operator|.
name|isAssignableFrom
argument_list|(
operator|(
name|Class
argument_list|<
name|?
argument_list|>
operator|)
name|cls
argument_list|)
condition|)
block|{
try|try
block|{
return|return
name|CastUtils
operator|.
name|cast
argument_list|(
operator|(
name|List
operator|)
name|cls
operator|.
name|newInstance
argument_list|()
argument_list|)
return|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
comment|// ignore, just return an ArrayList
block|}
block|}
block|}
block|}
return|return
operator|new
name|ArrayList
argument_list|<
name|Object
argument_list|>
argument_list|()
return|;
block|}
specifier|private
specifier|static
name|boolean
name|isList
parameter_list|(
name|MessagePartInfo
name|part
parameter_list|)
block|{
if|if
condition|(
name|part
operator|.
name|getTypeClass
argument_list|()
operator|.
name|isArray
argument_list|()
operator|&&
operator|!
name|part
operator|.
name|getTypeClass
argument_list|()
operator|.
name|getComponentType
argument_list|()
operator|.
name|isPrimitive
argument_list|()
condition|)
block|{
comment|//&& Collection.class.isAssignableFrom(part.getTypeClass())) {
comment|// it's List Para
comment|//
name|Type
name|genericType
init|=
operator|(
name|Type
operator|)
name|part
operator|.
name|getProperty
argument_list|(
literal|"generic.type"
argument_list|)
decl_stmt|;
if|if
condition|(
name|genericType
operator|instanceof
name|ParameterizedType
condition|)
block|{
name|Type
name|tp2
init|=
operator|(
operator|(
name|ParameterizedType
operator|)
name|genericType
operator|)
operator|.
name|getRawType
argument_list|()
decl_stmt|;
if|if
condition|(
name|tp2
operator|instanceof
name|Class
condition|)
block|{
return|return
name|Collection
operator|.
name|class
operator|.
name|isAssignableFrom
argument_list|(
operator|(
name|Class
argument_list|<
name|?
argument_list|>
operator|)
name|tp2
argument_list|)
return|;
block|}
block|}
block|}
return|return
literal|false
return|;
block|}
specifier|public
specifier|static
name|Object
name|unmarshall
parameter_list|(
name|JAXBContext
name|context
parameter_list|,
name|Schema
name|schema
parameter_list|,
name|Object
name|source
parameter_list|,
name|QName
name|elName
parameter_list|,
name|Class
argument_list|<
name|?
argument_list|>
name|clazz
parameter_list|,
name|AttachmentUnmarshaller
name|au
parameter_list|,
name|boolean
name|unwrap
parameter_list|)
block|{
name|Object
name|obj
init|=
literal|null
decl_stmt|;
try|try
block|{
name|Unmarshaller
name|u
init|=
name|createUnmarshaller
argument_list|(
name|context
argument_list|,
name|clazz
argument_list|)
decl_stmt|;
name|u
operator|.
name|setSchema
argument_list|(
name|schema
argument_list|)
expr_stmt|;
if|if
condition|(
name|au
operator|!=
literal|null
condition|)
block|{
name|u
operator|.
name|setAttachmentUnmarshaller
argument_list|(
name|au
argument_list|)
expr_stmt|;
block|}
name|boolean
name|unmarshalWithClass
init|=
literal|true
decl_stmt|;
if|if
condition|(
name|clazz
operator|==
literal|null
operator|||
operator|(
operator|!
name|clazz
operator|.
name|isPrimitive
argument_list|()
operator|&&
operator|!
name|clazz
operator|.
name|isArray
argument_list|()
operator|&&
operator|!
name|clazz
operator|.
name|isEnum
argument_list|()
operator|&&
operator|(
name|Modifier
operator|.
name|isAbstract
argument_list|(
name|clazz
operator|.
name|getModifiers
argument_list|()
argument_list|)
operator|||
name|Modifier
operator|.
name|isInterface
argument_list|(
name|clazz
operator|.
name|getModifiers
argument_list|()
argument_list|)
operator|)
operator|)
condition|)
block|{
name|unmarshalWithClass
operator|=
literal|false
expr_stmt|;
block|}
if|if
condition|(
name|clazz
operator|!=
literal|null
operator|&&
operator|(
name|clazz
operator|.
name|getName
argument_list|()
operator|.
name|equals
argument_list|(
literal|"javax.xml.datatype.XMLGregorianCalendar"
argument_list|)
operator|||
name|clazz
operator|.
name|getName
argument_list|()
operator|.
name|equals
argument_list|(
literal|"javax.xml.datatype.Duration"
argument_list|)
operator|)
condition|)
block|{
comment|// special treat two jaxb defined built-in abstract types
name|unmarshalWithClass
operator|=
literal|true
expr_stmt|;
block|}
if|if
condition|(
name|source
operator|instanceof
name|Node
condition|)
block|{
name|obj
operator|=
name|unmarshalWithClass
condition|?
name|u
operator|.
name|unmarshal
argument_list|(
operator|(
name|Node
operator|)
name|source
argument_list|,
name|clazz
argument_list|)
else|:
name|u
operator|.
name|unmarshal
argument_list|(
operator|(
name|Node
operator|)
name|source
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|source
operator|instanceof
name|XMLStreamReader
condition|)
block|{
name|obj
operator|=
name|unmarshalWithClass
condition|?
name|u
operator|.
name|unmarshal
argument_list|(
operator|(
name|XMLStreamReader
operator|)
name|source
argument_list|,
name|clazz
argument_list|)
else|:
name|u
operator|.
name|unmarshal
argument_list|(
operator|(
name|XMLStreamReader
operator|)
name|source
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|source
operator|instanceof
name|XMLEventReader
condition|)
block|{
name|obj
operator|=
name|unmarshalWithClass
condition|?
name|u
operator|.
name|unmarshal
argument_list|(
operator|(
name|XMLEventReader
operator|)
name|source
argument_list|,
name|clazz
argument_list|)
else|:
name|u
operator|.
name|unmarshal
argument_list|(
operator|(
name|XMLEventReader
operator|)
name|source
argument_list|)
expr_stmt|;
block|}
else|else
block|{
throw|throw
operator|new
name|Fault
argument_list|(
operator|new
name|Message
argument_list|(
literal|"UNKNOWN_SOURCE"
argument_list|,
name|BUNDLE
argument_list|,
name|source
operator|.
name|getClass
argument_list|()
operator|.
name|getName
argument_list|()
argument_list|)
argument_list|)
throw|;
block|}
block|}
catch|catch
parameter_list|(
name|Fault
name|ex
parameter_list|)
block|{
name|ex
operator|.
name|fillInStackTrace
argument_list|()
expr_stmt|;
throw|throw
name|ex
throw|;
block|}
catch|catch
parameter_list|(
name|Throwable
name|ex
parameter_list|)
block|{
if|if
condition|(
name|ex
operator|instanceof
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|UnmarshalException
condition|)
block|{
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|UnmarshalException
name|unmarshalEx
init|=
operator|(
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|UnmarshalException
operator|)
name|ex
decl_stmt|;
throw|throw
operator|new
name|Fault
argument_list|(
operator|new
name|Message
argument_list|(
literal|"UNMARSHAL_ERROR"
argument_list|,
name|BUNDLE
argument_list|,
name|unmarshalEx
operator|.
name|getLinkedException
argument_list|()
operator|.
name|getMessage
argument_list|()
argument_list|)
argument_list|,
name|ex
argument_list|)
throw|;
block|}
else|else
block|{
throw|throw
operator|new
name|Fault
argument_list|(
operator|new
name|Message
argument_list|(
literal|"UNMARSHAL_ERROR"
argument_list|,
name|BUNDLE
argument_list|,
name|ex
operator|.
name|getMessage
argument_list|()
argument_list|)
argument_list|,
name|ex
argument_list|)
throw|;
block|}
block|}
return|return
name|unwrap
condition|?
name|getElementValue
argument_list|(
name|obj
argument_list|)
else|:
name|obj
return|;
block|}
specifier|public
specifier|static
name|Object
name|getElementValue
parameter_list|(
name|Object
name|obj
parameter_list|)
block|{
if|if
condition|(
literal|null
operator|==
name|obj
condition|)
block|{
return|return
literal|null
return|;
block|}
if|if
condition|(
name|obj
operator|instanceof
name|JAXBElement
condition|)
block|{
return|return
operator|(
operator|(
name|JAXBElement
argument_list|<
name|?
argument_list|>
operator|)
name|obj
operator|)
operator|.
name|getValue
argument_list|()
return|;
block|}
return|return
name|obj
return|;
block|}
specifier|public
specifier|static
name|Class
argument_list|<
name|?
argument_list|>
name|getClassFromType
parameter_list|(
name|Type
name|t
parameter_list|)
block|{
if|if
condition|(
name|t
operator|instanceof
name|Class
condition|)
block|{
return|return
operator|(
name|Class
operator|)
name|t
return|;
block|}
elseif|else
if|if
condition|(
name|t
operator|instanceof
name|GenericArrayType
condition|)
block|{
name|GenericArrayType
name|g
init|=
operator|(
name|GenericArrayType
operator|)
name|t
decl_stmt|;
return|return
name|Array
operator|.
name|newInstance
argument_list|(
name|getClassFromType
argument_list|(
name|g
operator|.
name|getGenericComponentType
argument_list|()
argument_list|)
argument_list|,
literal|0
argument_list|)
operator|.
name|getClass
argument_list|()
return|;
block|}
elseif|else
if|if
condition|(
name|t
operator|instanceof
name|ParameterizedType
condition|)
block|{
name|ParameterizedType
name|p
init|=
operator|(
name|ParameterizedType
operator|)
name|t
decl_stmt|;
return|return
name|getClassFromType
argument_list|(
name|p
operator|.
name|getRawType
argument_list|()
argument_list|)
return|;
block|}
comment|// TypeVariable and WildCardType are not handled as it is unlikely such
comment|// Types will
comment|// JAXB Code Generated.
assert|assert
literal|false
assert|;
throw|throw
operator|new
name|IllegalArgumentException
argument_list|(
literal|"Cannot get Class object from unknown Type"
argument_list|)
throw|;
block|}
specifier|public
specifier|static
name|List
argument_list|<
name|Object
argument_list|>
name|unmarshallArray
parameter_list|(
name|JAXBContext
name|context
parameter_list|,
name|Schema
name|schema
parameter_list|,
name|Object
name|source
parameter_list|,
name|QName
name|elName
parameter_list|,
name|Class
argument_list|<
name|?
argument_list|>
name|clazz
parameter_list|,
name|AttachmentUnmarshaller
name|au
parameter_list|,
name|List
argument_list|<
name|Object
argument_list|>
name|ret
parameter_list|)
block|{
try|try
block|{
name|Unmarshaller
name|u
init|=
name|createUnmarshaller
argument_list|(
name|context
argument_list|,
name|clazz
argument_list|)
decl_stmt|;
name|u
operator|.
name|setSchema
argument_list|(
name|schema
argument_list|)
expr_stmt|;
if|if
condition|(
name|au
operator|!=
literal|null
condition|)
block|{
name|u
operator|.
name|setAttachmentUnmarshaller
argument_list|(
name|au
argument_list|)
expr_stmt|;
block|}
name|XMLStreamReader
name|reader
decl_stmt|;
if|if
condition|(
name|source
operator|instanceof
name|XMLStreamReader
condition|)
block|{
name|reader
operator|=
operator|(
name|XMLStreamReader
operator|)
name|source
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|source
operator|instanceof
name|Element
condition|)
block|{
name|reader
operator|=
name|StaxUtils
operator|.
name|createXMLStreamReader
argument_list|(
operator|(
name|Element
operator|)
name|source
argument_list|)
expr_stmt|;
block|}
else|else
block|{
throw|throw
operator|new
name|Fault
argument_list|(
operator|new
name|Message
argument_list|(
literal|"UNKNOWN_SOURCE"
argument_list|,
name|BUNDLE
argument_list|,
name|source
operator|.
name|getClass
argument_list|()
operator|.
name|getName
argument_list|()
argument_list|)
argument_list|)
throw|;
block|}
while|while
condition|(
name|reader
operator|.
name|getName
argument_list|()
operator|.
name|equals
argument_list|(
name|elName
argument_list|)
condition|)
block|{
name|Object
name|obj
init|=
name|u
operator|.
name|unmarshal
argument_list|(
name|reader
argument_list|,
name|clazz
argument_list|)
decl_stmt|;
if|if
condition|(
name|obj
operator|instanceof
name|JAXBElement
condition|)
block|{
name|obj
operator|=
operator|(
operator|(
name|JAXBElement
operator|)
name|obj
operator|)
operator|.
name|getValue
argument_list|()
expr_stmt|;
block|}
name|ret
operator|.
name|add
argument_list|(
name|obj
argument_list|)
expr_stmt|;
while|while
condition|(
name|reader
operator|.
name|getEventType
argument_list|()
operator|!=
name|XMLStreamConstants
operator|.
name|START_ELEMENT
operator|&&
name|reader
operator|.
name|getEventType
argument_list|()
operator|!=
name|XMLStreamConstants
operator|.
name|END_ELEMENT
condition|)
block|{
name|reader
operator|.
name|nextTag
argument_list|()
expr_stmt|;
block|}
block|}
return|return
name|ret
return|;
block|}
catch|catch
parameter_list|(
name|Fault
name|ex
parameter_list|)
block|{
name|ex
operator|.
name|fillInStackTrace
argument_list|()
expr_stmt|;
throw|throw
name|ex
throw|;
block|}
catch|catch
parameter_list|(
name|Exception
name|ex
parameter_list|)
block|{
if|if
condition|(
name|ex
operator|instanceof
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|UnmarshalException
condition|)
block|{
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|UnmarshalException
name|unmarshalEx
init|=
operator|(
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|UnmarshalException
operator|)
name|ex
decl_stmt|;
throw|throw
operator|new
name|Fault
argument_list|(
operator|new
name|Message
argument_list|(
literal|"UNMARSHAL_ERROR"
argument_list|,
name|BUNDLE
argument_list|,
name|unmarshalEx
operator|.
name|getLinkedException
argument_list|()
operator|.
name|getMessage
argument_list|()
argument_list|)
argument_list|,
name|ex
argument_list|)
throw|;
block|}
else|else
block|{
throw|throw
operator|new
name|Fault
argument_list|(
operator|new
name|Message
argument_list|(
literal|"UNMARSHAL_ERROR"
argument_list|,
name|BUNDLE
argument_list|,
name|ex
operator|.
name|getMessage
argument_list|()
argument_list|)
argument_list|,
name|ex
argument_list|)
throw|;
block|}
block|}
block|}
block|}
end_class

end_unit

