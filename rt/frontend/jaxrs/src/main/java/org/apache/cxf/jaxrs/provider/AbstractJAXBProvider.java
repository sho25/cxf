begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_comment
comment|/**  * Licensed to the Apache Software Foundation (ASF) under one  * or more contributor license agreements. See the NOTICE file  * distributed with this work for additional information  * regarding copyright ownership. The ASF licenses this file  * to you under the Apache License, Version 2.0 (the  * "License"); you may not use this file except in compliance  * with the License. You may obtain a copy of the License at  *  * http://www.apache.org/licenses/LICENSE-2.0  *  * Unless required by applicable law or agreed to in writing,  * software distributed under the License is distributed on an  * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY  * KIND, either express or implied. See the License for the  * specific language governing permissions and limitations  * under the License.  */
end_comment

begin_package
package|package
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|jaxrs
operator|.
name|provider
package|;
end_package

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|IOException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|InputStream
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|OutputStream
import|;
end_import

begin_import
import|import
name|java
operator|.
name|lang
operator|.
name|annotation
operator|.
name|Annotation
import|;
end_import

begin_import
import|import
name|java
operator|.
name|lang
operator|.
name|reflect
operator|.
name|Array
import|;
end_import

begin_import
import|import
name|java
operator|.
name|lang
operator|.
name|reflect
operator|.
name|Type
import|;
end_import

begin_import
import|import
name|java
operator|.
name|security
operator|.
name|AccessController
import|;
end_import

begin_import
import|import
name|java
operator|.
name|security
operator|.
name|PrivilegedAction
import|;
end_import

begin_import
import|import
name|java
operator|.
name|security
operator|.
name|PrivilegedActionException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|security
operator|.
name|PrivilegedExceptionAction
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|ArrayList
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Arrays
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Collections
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|HashSet
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|LinkedList
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|List
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Map
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Set
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|concurrent
operator|.
name|ConcurrentHashMap
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|ws
operator|.
name|rs
operator|.
name|WebApplicationException
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|ws
operator|.
name|rs
operator|.
name|core
operator|.
name|MediaType
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|ws
operator|.
name|rs
operator|.
name|core
operator|.
name|MultivaluedMap
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|ws
operator|.
name|rs
operator|.
name|core
operator|.
name|Response
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|ws
operator|.
name|rs
operator|.
name|core
operator|.
name|StreamingOutput
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|ws
operator|.
name|rs
operator|.
name|ext
operator|.
name|ContextResolver
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|ws
operator|.
name|rs
operator|.
name|ext
operator|.
name|MessageBodyReader
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|ws
operator|.
name|rs
operator|.
name|ext
operator|.
name|MessageBodyWriter
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|JAXBContext
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|JAXBElement
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|JAXBException
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|Marshaller
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|PropertyException
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|Unmarshaller
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|ValidationEventHandler
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|annotation
operator|.
name|XmlAnyElement
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|annotation
operator|.
name|XmlRootElement
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|annotation
operator|.
name|XmlType
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|bind
operator|.
name|annotation
operator|.
name|adapters
operator|.
name|XmlJavaTypeAdapter
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|namespace
operator|.
name|QName
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|stream
operator|.
name|XMLStreamException
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|stream
operator|.
name|XMLStreamReader
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|stream
operator|.
name|XMLStreamWriter
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|validation
operator|.
name|Schema
import|;
end_import

begin_import
import|import
name|org
operator|.
name|w3c
operator|.
name|dom
operator|.
name|Element
import|;
end_import

begin_import
import|import
name|org
operator|.
name|xml
operator|.
name|sax
operator|.
name|helpers
operator|.
name|DefaultHandler
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|annotations
operator|.
name|SchemaValidation
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|common
operator|.
name|jaxb
operator|.
name|JAXBUtils
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|common
operator|.
name|util
operator|.
name|PackageUtils
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|jaxrs
operator|.
name|ext
operator|.
name|MessageContext
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|jaxrs
operator|.
name|model
operator|.
name|ClassResourceInfo
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|jaxrs
operator|.
name|utils
operator|.
name|ExceptionUtils
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|jaxrs
operator|.
name|utils
operator|.
name|InjectionUtils
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|jaxrs
operator|.
name|utils
operator|.
name|JAXRSUtils
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|jaxrs
operator|.
name|utils
operator|.
name|ResourceUtils
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|jaxrs
operator|.
name|utils
operator|.
name|schemas
operator|.
name|SchemaHandler
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|message
operator|.
name|Message
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|phase
operator|.
name|PhaseInterceptorChain
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|staxutils
operator|.
name|DepthExceededStaxException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|staxutils
operator|.
name|DepthRestrictingStreamReader
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|staxutils
operator|.
name|DepthXMLStreamReader
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|staxutils
operator|.
name|DocumentDepthProperties
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|staxutils
operator|.
name|StaxUtils
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|staxutils
operator|.
name|transform
operator|.
name|TransformUtils
import|;
end_import

begin_class
specifier|public
specifier|abstract
class|class
name|AbstractJAXBProvider
parameter_list|<
name|T
parameter_list|>
extends|extends
name|AbstractConfigurableProvider
implements|implements
name|MessageBodyReader
argument_list|<
name|T
argument_list|>
implements|,
name|MessageBodyWriter
argument_list|<
name|T
argument_list|>
block|{
specifier|protected
specifier|static
specifier|final
name|String
name|NS_MAPPER_PROPERTY_RI
init|=
literal|"com.sun.xml.bind.namespacePrefixMapper"
decl_stmt|;
specifier|protected
specifier|static
specifier|final
name|String
name|NS_MAPPER_PROPERTY_RI_INT
init|=
literal|"com.sun.xml.internal.bind.namespacePrefixMapper"
decl_stmt|;
specifier|private
specifier|static
specifier|final
name|String
name|JAXB_DEFAULT_NAMESPACE
init|=
literal|"##default"
decl_stmt|;
specifier|private
specifier|static
specifier|final
name|String
name|JAXB_DEFAULT_NAME
init|=
literal|"##default"
decl_stmt|;
specifier|private
specifier|static
specifier|final
name|Set
argument_list|<
name|Class
argument_list|<
name|?
argument_list|>
argument_list|>
name|UNSUPPORTED_CLASSES
init|=
operator|new
name|HashSet
argument_list|<
name|Class
argument_list|<
name|?
argument_list|>
argument_list|>
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
name|InputStream
operator|.
name|class
argument_list|,
name|OutputStream
operator|.
name|class
argument_list|,
name|StreamingOutput
operator|.
name|class
argument_list|)
argument_list|)
decl_stmt|;
specifier|protected
name|Set
argument_list|<
name|Class
argument_list|<
name|?
argument_list|>
argument_list|>
name|collectionContextClasses
init|=
name|ConcurrentHashMap
operator|.
name|newKeySet
argument_list|()
decl_stmt|;
specifier|protected
name|Map
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|jaxbElementClassMap
init|=
name|Collections
operator|.
name|emptyMap
argument_list|()
decl_stmt|;
specifier|protected
name|boolean
name|unmarshalAsJaxbElement
decl_stmt|;
specifier|protected
name|boolean
name|marshalAsJaxbElement
decl_stmt|;
specifier|protected
name|boolean
name|xmlTypeAsJaxbElementOnly
decl_stmt|;
specifier|protected
name|Map
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|outElementsMap
decl_stmt|;
specifier|protected
name|Map
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|outAppendMap
decl_stmt|;
specifier|protected
name|List
argument_list|<
name|String
argument_list|>
name|outDropElements
decl_stmt|;
specifier|protected
name|List
argument_list|<
name|String
argument_list|>
name|inDropElements
decl_stmt|;
specifier|protected
name|Map
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|inElementsMap
decl_stmt|;
specifier|protected
name|Map
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|inAppendMap
decl_stmt|;
specifier|protected
name|Map
argument_list|<
name|String
argument_list|,
name|JAXBContext
argument_list|>
name|packageContexts
init|=
operator|new
name|ConcurrentHashMap
argument_list|<>
argument_list|()
decl_stmt|;
specifier|protected
name|Map
argument_list|<
name|Class
argument_list|<
name|?
argument_list|>
argument_list|,
name|JAXBContext
argument_list|>
name|classContexts
init|=
operator|new
name|ConcurrentHashMap
argument_list|<>
argument_list|()
decl_stmt|;
specifier|private
name|boolean
name|attributesToElements
decl_stmt|;
specifier|private
name|MessageContext
name|mc
decl_stmt|;
specifier|private
name|Schema
name|schema
decl_stmt|;
specifier|private
name|String
name|catalogLocation
decl_stmt|;
specifier|private
name|Map
argument_list|<
name|String
argument_list|,
name|SchemaHandler
argument_list|>
name|schemaHandlers
decl_stmt|;
specifier|private
name|String
name|collectionWrapperName
decl_stmt|;
specifier|private
name|Map
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|collectionWrapperMap
decl_stmt|;
specifier|private
name|List
argument_list|<
name|String
argument_list|>
name|jaxbElementClassNames
decl_stmt|;
specifier|private
name|boolean
name|xmlRootAsJaxbElement
decl_stmt|;
specifier|private
name|Map
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|cProperties
decl_stmt|;
specifier|private
name|Map
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|uProperties
decl_stmt|;
specifier|private
name|boolean
name|skipJaxbChecks
decl_stmt|;
specifier|private
name|boolean
name|singleJaxbContext
decl_stmt|;
specifier|private
name|boolean
name|useSingleContextForPackages
decl_stmt|;
specifier|private
name|Class
argument_list|<
name|?
argument_list|>
index|[]
name|extraClass
decl_stmt|;
specifier|private
name|boolean
name|validateInputIfPossible
init|=
literal|true
decl_stmt|;
specifier|private
name|boolean
name|validateOutputIfPossible
decl_stmt|;
specifier|private
name|boolean
name|validateBeforeWrite
decl_stmt|;
specifier|private
name|ValidationEventHandler
name|eventHandler
decl_stmt|;
specifier|private
name|Unmarshaller
operator|.
name|Listener
name|unmarshallerListener
decl_stmt|;
specifier|private
name|Marshaller
operator|.
name|Listener
name|marshallerListener
decl_stmt|;
specifier|private
name|DocumentDepthProperties
name|depthProperties
decl_stmt|;
specifier|private
name|String
name|namespaceMapperPropertyName
decl_stmt|;
specifier|private
specifier|static
name|JAXBContext
name|newJAXBContextInstance
parameter_list|(
name|Class
argument_list|<
name|?
argument_list|>
index|[]
name|classes
parameter_list|,
name|Map
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|cProperties
parameter_list|)
throws|throws
name|JAXBException
block|{
try|try
block|{
return|return
name|AccessController
operator|.
name|doPrivileged
argument_list|(
call|(
name|PrivilegedExceptionAction
argument_list|<
name|JAXBContext
argument_list|>
call|)
argument_list|()
operator|->
block|{
return|return
name|JAXBContext
operator|.
name|newInstance
argument_list|(
name|classes
argument_list|,
name|cProperties
argument_list|)
return|;
block|}
block|)
empty_stmt|;
block|}
catch|catch
parameter_list|(
name|PrivilegedActionException
name|e
parameter_list|)
block|{
name|Throwable
name|t
init|=
name|e
operator|.
name|getCause
argument_list|()
decl_stmt|;
if|if
condition|(
name|t
operator|instanceof
name|JAXBException
condition|)
block|{
throw|throw
operator|(
name|JAXBException
operator|)
name|t
throw|;
block|}
throw|throw
operator|new
name|RuntimeException
argument_list|(
name|t
argument_list|)
throw|;
block|}
block|}
end_class

begin_function
specifier|public
name|void
name|setXmlRootAsJaxbElement
parameter_list|(
name|boolean
name|xmlRootAsJaxbElement
parameter_list|)
block|{
name|this
operator|.
name|xmlRootAsJaxbElement
operator|=
name|xmlRootAsJaxbElement
expr_stmt|;
block|}
end_function

begin_function
specifier|protected
name|void
name|setNamespaceMapper
parameter_list|(
name|Marshaller
name|ms
parameter_list|,
name|Map
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|map
parameter_list|)
throws|throws
name|Exception
block|{
name|Object
name|nsMapper
init|=
name|JAXBUtils
operator|.
name|setNamespaceMapper
argument_list|(
name|map
argument_list|,
name|ms
argument_list|)
decl_stmt|;
if|if
condition|(
name|nsMapper
operator|!=
literal|null
operator|&&
name|namespaceMapperPropertyName
operator|!=
literal|null
condition|)
block|{
name|setMarshallerProp
argument_list|(
name|ms
argument_list|,
name|nsMapper
argument_list|,
name|namespaceMapperPropertyName
argument_list|,
literal|null
argument_list|)
expr_stmt|;
block|}
block|}
end_function

begin_function
specifier|protected
specifier|static
name|void
name|setMarshallerProp
parameter_list|(
name|Marshaller
name|ms
parameter_list|,
name|Object
name|value
parameter_list|,
name|String
name|name1
parameter_list|,
name|String
name|name2
parameter_list|)
throws|throws
name|Exception
block|{
try|try
block|{
name|ms
operator|.
name|setProperty
argument_list|(
name|name1
argument_list|,
name|value
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|PropertyException
name|ex
parameter_list|)
block|{
if|if
condition|(
name|name2
operator|!=
literal|null
condition|)
block|{
name|ms
operator|.
name|setProperty
argument_list|(
name|name2
argument_list|,
name|value
argument_list|)
expr_stmt|;
block|}
else|else
block|{
throw|throw
name|ex
throw|;
block|}
block|}
block|}
end_function

begin_function
specifier|public
name|void
name|setValidationHandler
parameter_list|(
name|ValidationEventHandler
name|handler
parameter_list|)
block|{
name|eventHandler
operator|=
name|handler
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|void
name|setSingleJaxbContext
parameter_list|(
name|boolean
name|useSingleContext
parameter_list|)
block|{
name|singleJaxbContext
operator|=
name|useSingleContext
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|void
name|setUseSingleContextForPackages
parameter_list|(
name|boolean
name|use
parameter_list|)
block|{
name|useSingleContextForPackages
operator|=
name|use
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|void
name|setExtraClass
parameter_list|(
name|Class
argument_list|<
name|?
argument_list|>
index|[]
name|userExtraClass
parameter_list|)
block|{
name|extraClass
operator|=
name|userExtraClass
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
specifier|public
name|void
name|init
parameter_list|(
name|List
argument_list|<
name|ClassResourceInfo
argument_list|>
name|cris
parameter_list|)
block|{
if|if
condition|(
name|singleJaxbContext
condition|)
block|{
name|JAXBContext
name|context
init|=
literal|null
decl_stmt|;
name|Set
argument_list|<
name|Class
argument_list|<
name|?
argument_list|>
argument_list|>
name|allTypes
init|=
literal|null
decl_stmt|;
if|if
condition|(
name|cris
operator|!=
literal|null
condition|)
block|{
name|allTypes
operator|=
operator|new
name|HashSet
argument_list|<>
argument_list|(
name|ResourceUtils
operator|.
name|getAllRequestResponseTypes
argument_list|(
name|cris
argument_list|,
literal|true
argument_list|)
operator|.
name|getAllTypes
argument_list|()
operator|.
name|keySet
argument_list|()
argument_list|)
expr_stmt|;
name|context
operator|=
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|jaxrs
operator|.
name|utils
operator|.
name|JAXBUtils
operator|.
name|createJaxbContext
argument_list|(
name|allTypes
argument_list|,
name|extraClass
argument_list|,
name|cProperties
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|extraClass
operator|!=
literal|null
condition|)
block|{
name|allTypes
operator|=
operator|new
name|HashSet
argument_list|<>
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
name|extraClass
argument_list|)
argument_list|)
expr_stmt|;
name|context
operator|=
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|jaxrs
operator|.
name|utils
operator|.
name|JAXBUtils
operator|.
name|createJaxbContext
argument_list|(
name|allTypes
argument_list|,
literal|null
argument_list|,
name|cProperties
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|context
operator|!=
literal|null
condition|)
block|{
for|for
control|(
name|Class
argument_list|<
name|?
argument_list|>
name|cls
range|:
name|allTypes
control|)
block|{
if|if
condition|(
name|useSingleContextForPackages
condition|)
block|{
name|packageContexts
operator|.
name|put
argument_list|(
name|PackageUtils
operator|.
name|getPackageName
argument_list|(
name|cls
argument_list|)
argument_list|,
name|context
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|classContexts
operator|.
name|put
argument_list|(
name|cls
argument_list|,
name|context
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
if|if
condition|(
name|cris
operator|!=
literal|null
condition|)
block|{
name|List
argument_list|<
name|String
argument_list|>
name|schemaLocs
init|=
operator|new
name|LinkedList
argument_list|<>
argument_list|()
decl_stmt|;
name|SchemaValidation
name|sv
init|=
literal|null
decl_stmt|;
for|for
control|(
name|ClassResourceInfo
name|cri
range|:
name|cris
control|)
block|{
name|sv
operator|=
name|cri
operator|.
name|getServiceClass
argument_list|()
operator|.
name|getAnnotation
argument_list|(
name|SchemaValidation
operator|.
name|class
argument_list|)
expr_stmt|;
if|if
condition|(
name|sv
operator|!=
literal|null
operator|&&
name|sv
operator|.
name|schemas
argument_list|()
operator|!=
literal|null
operator|&&
name|sv
operator|.
name|type
argument_list|()
operator|!=
name|SchemaValidation
operator|.
name|SchemaValidationType
operator|.
name|NONE
condition|)
block|{
for|for
control|(
name|String
name|s
range|:
name|sv
operator|.
name|schemas
argument_list|()
control|)
block|{
name|String
name|theSchema
init|=
name|s
decl_stmt|;
if|if
condition|(
operator|!
name|theSchema
operator|.
name|startsWith
argument_list|(
literal|"classpath:"
argument_list|)
condition|)
block|{
name|theSchema
operator|=
literal|"classpath:"
operator|+
name|theSchema
expr_stmt|;
block|}
name|schemaLocs
operator|.
name|add
argument_list|(
name|theSchema
argument_list|)
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
operator|!
name|schemaLocs
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|this
operator|.
name|setSchemaLocations
argument_list|(
name|schemaLocs
argument_list|)
expr_stmt|;
if|if
condition|(
name|cris
operator|.
name|isEmpty
argument_list|()
operator|&&
name|schema
operator|!=
literal|null
operator|&&
name|sv
operator|!=
literal|null
condition|)
block|{
name|SchemaValidation
operator|.
name|SchemaValidationType
name|type
init|=
name|sv
operator|.
name|type
argument_list|()
decl_stmt|;
if|if
condition|(
name|type
operator|==
name|SchemaValidation
operator|.
name|SchemaValidationType
operator|.
name|OUT
condition|)
block|{
name|validateInputIfPossible
operator|=
literal|false
expr_stmt|;
name|validateOutputIfPossible
operator|=
literal|true
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|type
operator|==
name|SchemaValidation
operator|.
name|SchemaValidationType
operator|.
name|BOTH
condition|)
block|{
name|validateOutputIfPossible
operator|=
literal|true
expr_stmt|;
block|}
block|}
block|}
block|}
block|}
end_function

begin_function
specifier|public
name|void
name|setContextProperties
parameter_list|(
name|Map
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|contextProperties
parameter_list|)
block|{
name|cProperties
operator|=
name|contextProperties
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|void
name|setUnmarshallerProperties
parameter_list|(
name|Map
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|unmarshalProperties
parameter_list|)
block|{
name|uProperties
operator|=
name|unmarshalProperties
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|void
name|setUnmarshallAsJaxbElement
parameter_list|(
name|boolean
name|value
parameter_list|)
block|{
name|unmarshalAsJaxbElement
operator|=
name|value
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|void
name|setMarshallAsJaxbElement
parameter_list|(
name|boolean
name|value
parameter_list|)
block|{
name|marshalAsJaxbElement
operator|=
name|value
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|void
name|setXmlTypeAsJaxbElementOnly
parameter_list|(
name|boolean
name|value
parameter_list|)
block|{
name|this
operator|.
name|xmlTypeAsJaxbElementOnly
operator|=
name|value
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|void
name|setJaxbElementClassNames
parameter_list|(
name|List
argument_list|<
name|String
argument_list|>
name|names
parameter_list|)
block|{
name|jaxbElementClassNames
operator|=
name|names
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|void
name|setJaxbElementClassMap
parameter_list|(
name|Map
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|map
parameter_list|)
block|{
name|jaxbElementClassMap
operator|=
name|map
expr_stmt|;
block|}
end_function

begin_function
specifier|protected
parameter_list|<
name|X
parameter_list|>
name|X
name|getStreamHandlerFromCurrentMessage
parameter_list|(
name|Class
argument_list|<
name|X
argument_list|>
name|staxCls
parameter_list|)
block|{
name|Message
name|m
init|=
name|PhaseInterceptorChain
operator|.
name|getCurrentMessage
argument_list|()
decl_stmt|;
if|if
condition|(
name|m
operator|!=
literal|null
condition|)
block|{
return|return
name|staxCls
operator|.
name|cast
argument_list|(
name|m
operator|.
name|getContent
argument_list|(
name|staxCls
argument_list|)
argument_list|)
return|;
block|}
return|return
literal|null
return|;
block|}
end_function

begin_function
specifier|protected
name|boolean
name|isXmlRoot
parameter_list|(
name|Class
argument_list|<
name|?
argument_list|>
name|cls
parameter_list|)
block|{
return|return
name|cls
operator|.
name|getAnnotation
argument_list|(
name|XmlRootElement
operator|.
name|class
argument_list|)
operator|!=
literal|null
return|;
block|}
end_function

begin_function
specifier|protected
name|boolean
name|isXmlType
parameter_list|(
name|Class
argument_list|<
name|?
argument_list|>
name|cls
parameter_list|)
block|{
return|return
name|cls
operator|.
name|getAnnotation
argument_list|(
name|XmlType
operator|.
name|class
argument_list|)
operator|!=
literal|null
return|;
block|}
end_function

begin_function
annotation|@
name|SuppressWarnings
argument_list|(
block|{
literal|"unchecked"
block|,
literal|"rawtypes"
block|}
argument_list|)
specifier|protected
name|Object
name|convertToJaxbElementIfNeeded
parameter_list|(
name|Object
name|obj
parameter_list|,
name|Class
argument_list|<
name|?
argument_list|>
name|cls
parameter_list|,
name|Type
name|genericType
parameter_list|)
throws|throws
name|Exception
block|{
name|Class
argument_list|<
name|?
argument_list|>
name|jaxbElementCls
init|=
name|jaxbElementClassNames
operator|==
literal|null
condition|?
literal|null
else|:
name|getJaxbElementClass
argument_list|(
name|cls
argument_list|)
decl_stmt|;
name|boolean
name|asJaxbElement
init|=
name|jaxbElementCls
operator|!=
literal|null
decl_stmt|;
if|if
condition|(
operator|!
name|asJaxbElement
operator|&&
name|isXmlRoot
argument_list|(
name|cls
argument_list|)
operator|&&
operator|!
name|xmlRootAsJaxbElement
condition|)
block|{
return|return
name|obj
return|;
block|}
if|if
condition|(
name|jaxbElementCls
operator|==
literal|null
condition|)
block|{
name|jaxbElementCls
operator|=
name|cls
expr_stmt|;
block|}
name|QName
name|name
init|=
literal|null
decl_stmt|;
name|String
name|expandedName
init|=
name|jaxbElementClassMap
operator|.
name|get
argument_list|(
name|jaxbElementCls
operator|.
name|getName
argument_list|()
argument_list|)
decl_stmt|;
if|if
condition|(
name|expandedName
operator|!=
literal|null
condition|)
block|{
name|name
operator|=
name|JAXRSUtils
operator|.
name|convertStringToQName
argument_list|(
name|expandedName
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|marshalAsJaxbElement
operator|||
name|asJaxbElement
condition|)
block|{
name|name
operator|=
name|getJaxbQName
argument_list|(
name|jaxbElementCls
argument_list|,
name|genericType
argument_list|,
name|obj
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
return|return
name|name
operator|!=
literal|null
condition|?
operator|new
name|JAXBElement
argument_list|<
name|Object
argument_list|>
argument_list|(
name|name
argument_list|,
operator|(
name|Class
operator|)
name|jaxbElementCls
argument_list|,
literal|null
argument_list|,
name|obj
argument_list|)
else|:
name|obj
return|;
block|}
end_function

begin_function
specifier|protected
name|Class
argument_list|<
name|?
argument_list|>
name|getJaxbElementClass
parameter_list|(
name|Class
argument_list|<
name|?
argument_list|>
name|cls
parameter_list|)
block|{
if|if
condition|(
name|cls
operator|==
name|Object
operator|.
name|class
condition|)
block|{
return|return
literal|null
return|;
block|}
if|if
condition|(
name|jaxbElementClassNames
operator|.
name|contains
argument_list|(
name|cls
operator|.
name|getName
argument_list|()
argument_list|)
condition|)
block|{
return|return
name|cls
return|;
block|}
return|return
name|getJaxbElementClass
argument_list|(
name|cls
operator|.
name|getSuperclass
argument_list|()
argument_list|)
return|;
block|}
end_function

begin_function
specifier|public
name|void
name|setCollectionWrapperName
parameter_list|(
name|String
name|wName
parameter_list|)
block|{
name|collectionWrapperName
operator|=
name|wName
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|void
name|setCollectionWrapperMap
parameter_list|(
name|Map
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|map
parameter_list|)
block|{
name|collectionWrapperMap
operator|=
name|map
expr_stmt|;
block|}
end_function

begin_function
specifier|protected
name|void
name|setContext
parameter_list|(
name|MessageContext
name|context
parameter_list|)
block|{
name|mc
operator|=
name|context
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|boolean
name|isWriteable
parameter_list|(
name|Class
argument_list|<
name|?
argument_list|>
name|type
parameter_list|,
name|Type
name|genericType
parameter_list|,
name|Annotation
index|[]
name|anns
parameter_list|,
name|MediaType
name|mt
parameter_list|)
block|{
if|if
condition|(
name|InjectionUtils
operator|.
name|isSupportedCollectionOrArray
argument_list|(
name|type
argument_list|)
condition|)
block|{
name|type
operator|=
name|InjectionUtils
operator|.
name|getActualType
argument_list|(
name|genericType
argument_list|)
expr_stmt|;
if|if
condition|(
name|type
operator|==
literal|null
condition|)
block|{
return|return
literal|false
return|;
block|}
block|}
return|return
name|marshalAsJaxbElement
operator|&&
operator|(
operator|!
name|xmlTypeAsJaxbElementOnly
operator|||
name|isXmlType
argument_list|(
name|type
argument_list|)
operator|)
operator|||
name|isSupported
argument_list|(
name|type
argument_list|,
name|genericType
argument_list|,
name|anns
argument_list|)
return|;
block|}
end_function

begin_function
specifier|public
name|void
name|writeTo
parameter_list|(
name|T
name|t
parameter_list|,
name|Type
name|genericType
parameter_list|,
name|Annotation
index|[]
name|annotations
parameter_list|,
name|MediaType
name|mediaType
parameter_list|,
name|MultivaluedMap
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|httpHeaders
parameter_list|,
name|OutputStream
name|entityStream
parameter_list|)
throws|throws
name|IOException
throws|,
name|WebApplicationException
block|{
annotation|@
name|SuppressWarnings
argument_list|(
literal|"unchecked"
argument_list|)
name|Class
argument_list|<
name|T
argument_list|>
name|type
init|=
operator|(
name|Class
argument_list|<
name|T
argument_list|>
operator|)
name|t
operator|.
name|getClass
argument_list|()
decl_stmt|;
name|writeTo
argument_list|(
name|t
argument_list|,
name|type
argument_list|,
name|genericType
argument_list|,
name|annotations
argument_list|,
name|mediaType
argument_list|,
name|httpHeaders
argument_list|,
name|entityStream
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|protected
name|JAXBContext
name|getCollectionContext
parameter_list|(
name|Class
argument_list|<
name|?
argument_list|>
name|type
parameter_list|)
throws|throws
name|JAXBException
block|{
if|if
condition|(
name|collectionContextClasses
operator|.
name|add
argument_list|(
name|type
argument_list|)
condition|)
block|{
name|collectionContextClasses
operator|.
name|add
argument_list|(
name|CollectionWrapper
operator|.
name|class
argument_list|)
expr_stmt|;
block|}
return|return
name|newJAXBContextInstance
argument_list|(
name|collectionContextClasses
operator|.
name|toArray
argument_list|(
operator|new
name|Class
index|[
literal|0
index|]
argument_list|)
argument_list|,
name|cProperties
argument_list|)
return|;
block|}
end_function

begin_function
specifier|protected
name|QName
name|getCollectionWrapperQName
parameter_list|(
name|Class
argument_list|<
name|?
argument_list|>
name|cls
parameter_list|,
name|Type
name|type
parameter_list|,
name|Object
name|object
parameter_list|,
name|boolean
name|pluralName
parameter_list|)
throws|throws
name|Exception
block|{
name|String
name|name
init|=
name|getCollectionWrapperName
argument_list|(
name|cls
argument_list|)
decl_stmt|;
if|if
condition|(
name|name
operator|==
literal|null
condition|)
block|{
return|return
name|getJaxbQName
argument_list|(
name|cls
argument_list|,
name|type
argument_list|,
name|object
argument_list|,
name|pluralName
argument_list|)
return|;
block|}
return|return
name|JAXRSUtils
operator|.
name|convertStringToQName
argument_list|(
name|name
argument_list|)
return|;
block|}
end_function

begin_function
specifier|private
name|String
name|getCollectionWrapperName
parameter_list|(
name|Class
argument_list|<
name|?
argument_list|>
name|cls
parameter_list|)
block|{
if|if
condition|(
name|collectionWrapperName
operator|!=
literal|null
condition|)
block|{
return|return
name|collectionWrapperName
return|;
block|}
if|if
condition|(
name|collectionWrapperMap
operator|!=
literal|null
condition|)
block|{
return|return
name|collectionWrapperMap
operator|.
name|get
argument_list|(
name|cls
operator|.
name|getName
argument_list|()
argument_list|)
return|;
block|}
return|return
literal|null
return|;
block|}
end_function

begin_function
specifier|protected
name|QName
name|getJaxbQName
parameter_list|(
name|Class
argument_list|<
name|?
argument_list|>
name|cls
parameter_list|,
name|Type
name|type
parameter_list|,
name|Object
name|object
parameter_list|,
name|boolean
name|pluralName
parameter_list|)
throws|throws
name|Exception
block|{
if|if
condition|(
name|cls
operator|==
name|JAXBElement
operator|.
name|class
condition|)
block|{
return|return
name|object
operator|!=
literal|null
condition|?
operator|(
operator|(
name|JAXBElement
argument_list|<
name|?
argument_list|>
operator|)
name|object
operator|)
operator|.
name|getName
argument_list|()
else|:
literal|null
return|;
block|}
name|XmlRootElement
name|root
init|=
name|cls
operator|.
name|getAnnotation
argument_list|(
name|XmlRootElement
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|root
operator|!=
literal|null
condition|)
block|{
return|return
name|getQNameFromNamespaceAndName
argument_list|(
name|root
operator|.
name|namespace
argument_list|()
argument_list|,
name|root
operator|.
name|name
argument_list|()
argument_list|,
name|cls
argument_list|,
name|pluralName
argument_list|)
return|;
block|}
elseif|else
if|if
condition|(
name|isXmlType
argument_list|(
name|cls
argument_list|)
condition|)
block|{
name|XmlType
name|xmlType
init|=
name|cls
operator|.
name|getAnnotation
argument_list|(
name|XmlType
operator|.
name|class
argument_list|)
decl_stmt|;
return|return
name|getQNameFromNamespaceAndName
argument_list|(
name|xmlType
operator|.
name|namespace
argument_list|()
argument_list|,
name|xmlType
operator|.
name|name
argument_list|()
argument_list|,
name|cls
argument_list|,
name|pluralName
argument_list|)
return|;
block|}
else|else
block|{
return|return
operator|new
name|QName
argument_list|(
name|getPackageNamespace
argument_list|(
name|cls
argument_list|)
argument_list|,
name|cls
operator|.
name|getSimpleName
argument_list|()
argument_list|)
return|;
block|}
block|}
end_function

begin_function
specifier|private
specifier|static
name|QName
name|getQNameFromNamespaceAndName
parameter_list|(
name|String
name|ns
parameter_list|,
name|String
name|localName
parameter_list|,
name|Class
argument_list|<
name|?
argument_list|>
name|cls
parameter_list|,
name|boolean
name|plural
parameter_list|)
block|{
name|String
name|name
init|=
name|getLocalName
argument_list|(
name|localName
argument_list|,
name|cls
operator|.
name|getSimpleName
argument_list|()
argument_list|,
name|plural
argument_list|)
decl_stmt|;
name|String
name|namespace
init|=
name|getNamespace
argument_list|(
name|ns
argument_list|)
decl_stmt|;
if|if
condition|(
literal|""
operator|.
name|equals
argument_list|(
name|namespace
argument_list|)
condition|)
block|{
name|namespace
operator|=
name|getPackageNamespace
argument_list|(
name|cls
argument_list|)
expr_stmt|;
block|}
return|return
operator|new
name|QName
argument_list|(
name|namespace
argument_list|,
name|name
argument_list|)
return|;
block|}
end_function

begin_function
specifier|private
specifier|static
name|String
name|getLocalName
parameter_list|(
name|String
name|name
parameter_list|,
name|String
name|clsName
parameter_list|,
name|boolean
name|pluralName
parameter_list|)
block|{
if|if
condition|(
name|JAXB_DEFAULT_NAME
operator|.
name|equals
argument_list|(
name|name
argument_list|)
condition|)
block|{
name|name
operator|=
name|clsName
expr_stmt|;
if|if
condition|(
name|name
operator|.
name|length
argument_list|()
operator|>
literal|1
condition|)
block|{
name|name
operator|=
name|name
operator|.
name|substring
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|)
operator|.
name|toLowerCase
argument_list|()
operator|+
name|name
operator|.
name|substring
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|name
operator|=
name|name
operator|.
name|toLowerCase
argument_list|()
expr_stmt|;
block|}
block|}
if|if
condition|(
name|pluralName
condition|)
block|{
name|name
operator|+=
literal|'s'
expr_stmt|;
block|}
return|return
name|name
return|;
block|}
end_function

begin_function
specifier|private
specifier|static
name|String
name|getPackageNamespace
parameter_list|(
name|Class
argument_list|<
name|?
argument_list|>
name|cls
parameter_list|)
block|{
name|String
name|packageNs
init|=
name|JAXBUtils
operator|.
name|getPackageNamespace
argument_list|(
name|cls
argument_list|)
decl_stmt|;
return|return
name|packageNs
operator|!=
literal|null
condition|?
name|getNamespace
argument_list|(
name|packageNs
argument_list|)
else|:
literal|""
return|;
block|}
end_function

begin_function
specifier|private
specifier|static
name|String
name|getNamespace
parameter_list|(
name|String
name|namespace
parameter_list|)
block|{
if|if
condition|(
name|JAXB_DEFAULT_NAMESPACE
operator|.
name|equals
argument_list|(
name|namespace
argument_list|)
condition|)
block|{
return|return
literal|""
return|;
block|}
return|return
name|namespace
return|;
block|}
end_function

begin_function
specifier|public
name|boolean
name|isReadable
parameter_list|(
name|Class
argument_list|<
name|?
argument_list|>
name|type
parameter_list|,
name|Type
name|genericType
parameter_list|,
name|Annotation
index|[]
name|anns
parameter_list|,
name|MediaType
name|mt
parameter_list|)
block|{
if|if
condition|(
name|InjectionUtils
operator|.
name|isSupportedCollectionOrArray
argument_list|(
name|type
argument_list|)
condition|)
block|{
name|type
operator|=
name|InjectionUtils
operator|.
name|getActualType
argument_list|(
name|genericType
argument_list|)
expr_stmt|;
if|if
condition|(
name|type
operator|==
literal|null
condition|)
block|{
return|return
literal|false
return|;
block|}
block|}
return|return
name|canBeReadAsJaxbElement
argument_list|(
name|type
argument_list|)
operator|||
name|isSupported
argument_list|(
name|type
argument_list|,
name|genericType
argument_list|,
name|anns
argument_list|)
return|;
block|}
end_function

begin_function
specifier|protected
name|boolean
name|canBeReadAsJaxbElement
parameter_list|(
name|Class
argument_list|<
name|?
argument_list|>
name|type
parameter_list|)
block|{
return|return
name|unmarshalAsJaxbElement
operator|&&
name|type
operator|!=
name|Response
operator|.
name|class
return|;
block|}
end_function

begin_function
specifier|public
name|void
name|setSchemaLocations
parameter_list|(
name|List
argument_list|<
name|String
argument_list|>
name|locations
parameter_list|)
block|{
name|schema
operator|=
name|SchemaHandler
operator|.
name|createSchema
argument_list|(
name|locations
argument_list|,
name|catalogLocation
argument_list|,
name|getBus
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|void
name|setCatalogLocation
parameter_list|(
name|String
name|name
parameter_list|)
block|{
name|this
operator|.
name|catalogLocation
operator|=
name|name
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|void
name|setSchemaHandler
parameter_list|(
name|SchemaHandler
name|handler
parameter_list|)
block|{
name|setSchema
argument_list|(
name|handler
operator|.
name|getSchema
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|void
name|setSchemaHandlers
parameter_list|(
name|Map
argument_list|<
name|String
argument_list|,
name|SchemaHandler
argument_list|>
name|handlers
parameter_list|)
block|{
name|schemaHandlers
operator|=
name|handlers
expr_stmt|;
block|}
end_function

begin_function
specifier|protected
name|void
name|setSchema
parameter_list|(
name|Schema
name|s
parameter_list|)
block|{
name|schema
operator|=
name|s
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|long
name|getSize
parameter_list|(
name|T
name|o
parameter_list|,
name|Class
argument_list|<
name|?
argument_list|>
name|type
parameter_list|,
name|Type
name|genericType
parameter_list|,
name|Annotation
index|[]
name|annotations
parameter_list|,
name|MediaType
name|mt
parameter_list|)
block|{
return|return
operator|-
literal|1
return|;
block|}
end_function

begin_function
specifier|protected
name|MessageContext
name|getContext
parameter_list|()
block|{
return|return
name|mc
return|;
block|}
end_function

begin_function
annotation|@
name|SuppressWarnings
argument_list|(
literal|"unchecked"
argument_list|)
specifier|public
name|JAXBContext
name|getJAXBContext
parameter_list|(
name|Class
argument_list|<
name|?
argument_list|>
name|type
parameter_list|,
name|Type
name|genericType
parameter_list|)
throws|throws
name|JAXBException
block|{
if|if
condition|(
name|mc
operator|!=
literal|null
condition|)
block|{
name|ContextResolver
argument_list|<
name|JAXBContext
argument_list|>
name|resolver
init|=
name|mc
operator|.
name|getResolver
argument_list|(
name|ContextResolver
operator|.
name|class
argument_list|,
name|JAXBContext
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|resolver
operator|!=
literal|null
condition|)
block|{
name|JAXBContext
name|customContext
init|=
name|resolver
operator|.
name|getContext
argument_list|(
name|type
argument_list|)
decl_stmt|;
if|if
condition|(
name|customContext
operator|!=
literal|null
condition|)
block|{
return|return
name|customContext
return|;
block|}
block|}
block|}
name|JAXBContext
name|context
init|=
name|classContexts
operator|.
name|get
argument_list|(
name|type
argument_list|)
decl_stmt|;
if|if
condition|(
name|context
operator|!=
literal|null
condition|)
block|{
return|return
name|context
return|;
block|}
name|context
operator|=
name|getPackageContext
argument_list|(
name|type
argument_list|,
name|genericType
argument_list|)
expr_stmt|;
return|return
name|context
operator|!=
literal|null
condition|?
name|context
else|:
name|getClassContext
argument_list|(
name|type
argument_list|,
name|genericType
argument_list|)
return|;
block|}
end_function

begin_function
specifier|public
name|JAXBContext
name|getClassContext
parameter_list|(
name|Class
argument_list|<
name|?
argument_list|>
name|type
parameter_list|)
throws|throws
name|JAXBException
block|{
return|return
name|getClassContext
argument_list|(
name|type
argument_list|,
name|type
argument_list|)
return|;
block|}
end_function

begin_function
specifier|protected
name|JAXBContext
name|getClassContext
parameter_list|(
name|Class
argument_list|<
name|?
argument_list|>
name|type
parameter_list|,
name|Type
name|genericType
parameter_list|)
throws|throws
name|JAXBException
block|{
specifier|final
name|JAXBException
index|[]
name|jaxbException
init|=
operator|new
name|JAXBException
index|[]
block|{
literal|null
block|}
decl_stmt|;
specifier|final
name|JAXBContext
name|context
init|=
name|classContexts
operator|.
name|computeIfAbsent
argument_list|(
name|type
argument_list|,
name|t
lambda|->
block|{
specifier|final
name|Class
argument_list|<
name|?
argument_list|>
index|[]
name|classes
decl_stmt|;
if|if
condition|(
name|extraClass
operator|!=
literal|null
condition|)
block|{
name|classes
operator|=
operator|new
name|Class
index|[
name|extraClass
operator|.
name|length
operator|+
literal|1
index|]
expr_stmt|;
name|classes
index|[
literal|0
index|]
operator|=
name|type
expr_stmt|;
name|System
operator|.
name|arraycopy
argument_list|(
name|extraClass
argument_list|,
literal|0
argument_list|,
name|classes
argument_list|,
literal|1
argument_list|,
name|extraClass
operator|.
name|length
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|classes
operator|=
operator|new
name|Class
index|[]
block|{
name|type
block|}
empty_stmt|;
block|}
try|try
block|{
return|return
name|newJAXBContextInstance
argument_list|(
name|classes
argument_list|,
name|cProperties
argument_list|)
return|;
block|}
catch|catch
parameter_list|(
name|JAXBException
name|e
parameter_list|)
block|{
name|jaxbException
index|[
literal|0
index|]
operator|=
name|e
expr_stmt|;
return|return
literal|null
return|;
block|}
block|}
argument_list|)
decl_stmt|;
if|if
condition|(
literal|null
operator|!=
name|jaxbException
index|[
literal|0
index|]
condition|)
block|{
throw|throw
name|jaxbException
index|[
literal|0
index|]
throw|;
block|}
return|return
name|context
return|;
block|}
end_function

begin_function
specifier|public
name|JAXBContext
name|getPackageContext
parameter_list|(
name|Class
argument_list|<
name|?
argument_list|>
name|type
parameter_list|)
block|{
return|return
name|getPackageContext
argument_list|(
name|type
argument_list|,
name|type
argument_list|)
return|;
block|}
end_function

begin_function
specifier|protected
name|JAXBContext
name|getPackageContext
parameter_list|(
specifier|final
name|Class
argument_list|<
name|?
argument_list|>
name|type
parameter_list|,
name|Type
name|genericType
parameter_list|)
block|{
if|if
condition|(
name|type
operator|==
literal|null
operator|||
name|type
operator|==
name|JAXBElement
operator|.
name|class
condition|)
block|{
return|return
literal|null
return|;
block|}
specifier|final
name|String
name|packageName
init|=
name|PackageUtils
operator|.
name|getPackageName
argument_list|(
name|type
argument_list|)
decl_stmt|;
return|return
name|packageContexts
operator|.
name|computeIfAbsent
argument_list|(
name|packageName
argument_list|,
name|p
lambda|->
block|{
try|try
block|{
specifier|final
name|ClassLoader
name|loader
init|=
name|AccessController
operator|.
name|doPrivileged
argument_list|(
call|(
name|PrivilegedAction
argument_list|<
name|ClassLoader
argument_list|>
call|)
argument_list|()
operator|->
block|{
return|return
name|type
operator|.
name|getClassLoader
argument_list|()
return|;
block|}
argument_list|)
return|;
if|if
condition|(
name|loader
operator|!=
literal|null
operator|&&
name|objectFactoryOrIndexAvailable
argument_list|(
name|type
argument_list|)
condition|)
block|{
name|String
name|contextName
init|=
name|packageName
decl_stmt|;
if|if
condition|(
name|extraClass
operator|!=
literal|null
condition|)
block|{
name|StringBuilder
name|sb
init|=
operator|new
name|StringBuilder
argument_list|(
name|contextName
argument_list|)
decl_stmt|;
for|for
control|(
name|Class
argument_list|<
name|?
argument_list|>
name|extra
range|:
name|extraClass
control|)
block|{
name|String
name|extraPackage
init|=
name|PackageUtils
operator|.
name|getPackageName
argument_list|(
name|extra
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|extraPackage
operator|.
name|equals
argument_list|(
name|packageName
argument_list|)
condition|)
block|{
name|sb
operator|.
name|append
argument_list|(
literal|':'
argument_list|)
operator|.
name|append
argument_list|(
name|extraPackage
argument_list|)
expr_stmt|;
block|}
block|}
name|contextName
operator|=
name|sb
operator|.
name|toString
argument_list|()
expr_stmt|;
block|}
return|return
name|JAXBContext
operator|.
name|newInstance
argument_list|(
name|contextName
argument_list|,
name|loader
argument_list|,
name|cProperties
argument_list|)
return|;
block|}
block|}
end_function

begin_catch
catch|catch
parameter_list|(
name|JAXBException
name|ex
parameter_list|)
block|{
name|LOG
operator|.
name|fine
argument_list|(
literal|"Error creating a JAXBContext using ObjectFactory : "
operator|+
name|ex
operator|.
name|getMessage
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_catch

begin_return
return|return
literal|null
return|;
end_return

begin_empty_stmt
unit|})
empty_stmt|;
end_empty_stmt

begin_function
unit|}      protected
name|boolean
name|isSupported
parameter_list|(
name|Class
argument_list|<
name|?
argument_list|>
name|type
parameter_list|,
name|Type
name|genericType
parameter_list|,
name|Annotation
index|[]
name|anns
parameter_list|)
block|{
if|if
condition|(
name|jaxbElementClassMap
operator|!=
literal|null
operator|&&
name|jaxbElementClassMap
operator|.
name|containsKey
argument_list|(
name|type
operator|.
name|getName
argument_list|()
argument_list|)
operator|||
name|isSkipJaxbChecks
argument_list|()
condition|)
block|{
return|return
literal|true
return|;
block|}
if|if
condition|(
name|UNSUPPORTED_CLASSES
operator|.
name|contains
argument_list|(
name|type
argument_list|)
condition|)
block|{
return|return
literal|false
return|;
block|}
return|return
name|isXmlRoot
argument_list|(
name|type
argument_list|)
operator|||
name|JAXBElement
operator|.
name|class
operator|.
name|isAssignableFrom
argument_list|(
name|type
argument_list|)
operator|||
name|objectFactoryOrIndexAvailable
argument_list|(
name|type
argument_list|)
operator|||
operator|(
name|type
operator|!=
name|genericType
operator|&&
name|objectFactoryForType
argument_list|(
name|genericType
argument_list|)
operator|)
operator|||
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|jaxrs
operator|.
name|utils
operator|.
name|JAXBUtils
operator|.
name|getAdapter
argument_list|(
name|type
argument_list|,
name|anns
argument_list|)
operator|!=
literal|null
return|;
block|}
end_function

begin_function
specifier|protected
name|boolean
name|objectFactoryOrIndexAvailable
parameter_list|(
name|Class
argument_list|<
name|?
argument_list|>
name|type
parameter_list|)
block|{
return|return
name|type
operator|.
name|getResource
argument_list|(
literal|"ObjectFactory.class"
argument_list|)
operator|!=
literal|null
operator|||
name|type
operator|.
name|getResource
argument_list|(
literal|"jaxb.index"
argument_list|)
operator|!=
literal|null
return|;
block|}
end_function

begin_function
specifier|private
name|boolean
name|objectFactoryForType
parameter_list|(
name|Type
name|genericType
parameter_list|)
block|{
return|return
name|objectFactoryOrIndexAvailable
argument_list|(
name|InjectionUtils
operator|.
name|getActualType
argument_list|(
name|genericType
argument_list|)
argument_list|)
return|;
block|}
end_function

begin_function
specifier|protected
name|Unmarshaller
name|createUnmarshaller
parameter_list|(
name|Class
argument_list|<
name|?
argument_list|>
name|cls
parameter_list|,
name|Type
name|genericType
parameter_list|)
throws|throws
name|JAXBException
block|{
return|return
name|createUnmarshaller
argument_list|(
name|cls
argument_list|,
name|genericType
argument_list|,
literal|false
argument_list|)
return|;
block|}
end_function

begin_function
specifier|protected
name|Unmarshaller
name|createUnmarshaller
parameter_list|(
name|Class
argument_list|<
name|?
argument_list|>
name|cls
parameter_list|,
name|Type
name|genericType
parameter_list|,
name|boolean
name|isCollection
parameter_list|)
throws|throws
name|JAXBException
block|{
name|JAXBContext
name|context
init|=
name|isCollection
condition|?
name|getCollectionContext
argument_list|(
name|cls
argument_list|)
else|:
name|getJAXBContext
argument_list|(
name|cls
argument_list|,
name|genericType
argument_list|)
decl_stmt|;
name|Unmarshaller
name|unmarshaller
init|=
name|context
operator|.
name|createUnmarshaller
argument_list|()
decl_stmt|;
if|if
condition|(
name|validateInputIfPossible
condition|)
block|{
name|Schema
name|theSchema
init|=
name|getSchema
argument_list|(
name|cls
argument_list|)
decl_stmt|;
if|if
condition|(
name|theSchema
operator|!=
literal|null
condition|)
block|{
name|unmarshaller
operator|.
name|setSchema
argument_list|(
name|theSchema
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|eventHandler
operator|!=
literal|null
condition|)
block|{
name|unmarshaller
operator|.
name|setEventHandler
argument_list|(
name|eventHandler
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|unmarshallerListener
operator|!=
literal|null
condition|)
block|{
name|unmarshaller
operator|.
name|setListener
argument_list|(
name|unmarshallerListener
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|uProperties
operator|!=
literal|null
condition|)
block|{
for|for
control|(
name|Map
operator|.
name|Entry
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|entry
range|:
name|uProperties
operator|.
name|entrySet
argument_list|()
control|)
block|{
name|unmarshaller
operator|.
name|setProperty
argument_list|(
name|entry
operator|.
name|getKey
argument_list|()
argument_list|,
name|entry
operator|.
name|getValue
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|unmarshaller
return|;
block|}
end_function

begin_function
specifier|protected
name|Marshaller
name|createMarshaller
parameter_list|(
name|Object
name|obj
parameter_list|,
name|Class
argument_list|<
name|?
argument_list|>
name|cls
parameter_list|,
name|Type
name|genericType
parameter_list|,
name|String
name|enc
parameter_list|)
throws|throws
name|JAXBException
block|{
name|Class
argument_list|<
name|?
argument_list|>
name|objClazz
init|=
name|JAXBElement
operator|.
name|class
operator|.
name|isAssignableFrom
argument_list|(
name|cls
argument_list|)
condition|?
operator|(
operator|(
name|JAXBElement
argument_list|<
name|?
argument_list|>
operator|)
name|obj
operator|)
operator|.
name|getDeclaredType
argument_list|()
else|:
name|cls
decl_stmt|;
name|JAXBContext
name|context
init|=
name|getJAXBContext
argument_list|(
name|objClazz
argument_list|,
name|genericType
argument_list|)
decl_stmt|;
name|Marshaller
name|marshaller
init|=
name|context
operator|.
name|createMarshaller
argument_list|()
decl_stmt|;
if|if
condition|(
name|enc
operator|!=
literal|null
condition|)
block|{
name|marshaller
operator|.
name|setProperty
argument_list|(
name|Marshaller
operator|.
name|JAXB_ENCODING
argument_list|,
name|enc
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|marshallerListener
operator|!=
literal|null
condition|)
block|{
name|marshaller
operator|.
name|setListener
argument_list|(
name|marshallerListener
argument_list|)
expr_stmt|;
block|}
name|validateObjectIfNeeded
argument_list|(
name|marshaller
argument_list|,
name|cls
argument_list|,
name|obj
argument_list|)
expr_stmt|;
return|return
name|marshaller
return|;
block|}
end_function

begin_function
specifier|protected
name|void
name|validateObjectIfNeeded
parameter_list|(
name|Marshaller
name|marshaller
parameter_list|,
name|Class
argument_list|<
name|?
argument_list|>
name|cls
parameter_list|,
name|Object
name|obj
parameter_list|)
throws|throws
name|JAXBException
block|{
if|if
condition|(
name|validateOutputIfPossible
condition|)
block|{
name|Schema
name|theSchema
init|=
name|getSchema
argument_list|(
name|cls
argument_list|)
decl_stmt|;
if|if
condition|(
name|theSchema
operator|!=
literal|null
condition|)
block|{
name|marshaller
operator|.
name|setEventHandler
argument_list|(
name|eventHandler
argument_list|)
expr_stmt|;
name|marshaller
operator|.
name|setSchema
argument_list|(
name|theSchema
argument_list|)
expr_stmt|;
if|if
condition|(
name|validateBeforeWrite
condition|)
block|{
name|marshaller
operator|.
name|marshal
argument_list|(
name|obj
argument_list|,
operator|new
name|DefaultHandler
argument_list|()
argument_list|)
expr_stmt|;
name|marshaller
operator|.
name|setSchema
argument_list|(
literal|null
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
end_function

begin_function
specifier|protected
name|Class
argument_list|<
name|?
argument_list|>
name|getActualType
parameter_list|(
name|Class
argument_list|<
name|?
argument_list|>
name|type
parameter_list|,
name|Type
name|genericType
parameter_list|,
name|Annotation
index|[]
name|anns
parameter_list|)
block|{
name|Class
argument_list|<
name|?
argument_list|>
name|theType
init|=
literal|null
decl_stmt|;
if|if
condition|(
name|JAXBElement
operator|.
name|class
operator|.
name|isAssignableFrom
argument_list|(
name|type
argument_list|)
condition|)
block|{
name|theType
operator|=
name|InjectionUtils
operator|.
name|getActualType
argument_list|(
name|genericType
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|theType
operator|=
name|type
expr_stmt|;
block|}
name|XmlJavaTypeAdapter
name|adapter
init|=
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|jaxrs
operator|.
name|utils
operator|.
name|JAXBUtils
operator|.
name|getAdapter
argument_list|(
name|theType
argument_list|,
name|anns
argument_list|)
decl_stmt|;
name|theType
operator|=
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|jaxrs
operator|.
name|utils
operator|.
name|JAXBUtils
operator|.
name|getTypeFromAdapter
argument_list|(
name|adapter
argument_list|,
name|theType
argument_list|,
literal|false
argument_list|)
expr_stmt|;
return|return
name|theType
return|;
block|}
end_function

begin_function
specifier|protected
specifier|static
name|Object
name|checkAdapter
parameter_list|(
name|Object
name|obj
parameter_list|,
name|Class
argument_list|<
name|?
argument_list|>
name|cls
parameter_list|,
name|Annotation
index|[]
name|anns
parameter_list|,
name|boolean
name|marshal
parameter_list|)
block|{
name|XmlJavaTypeAdapter
name|adapter
init|=
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|jaxrs
operator|.
name|utils
operator|.
name|JAXBUtils
operator|.
name|getAdapter
argument_list|(
name|cls
argument_list|,
name|anns
argument_list|)
decl_stmt|;
return|return
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|jaxrs
operator|.
name|utils
operator|.
name|JAXBUtils
operator|.
name|useAdapter
argument_list|(
name|obj
argument_list|,
name|adapter
argument_list|,
name|marshal
argument_list|)
return|;
block|}
end_function

begin_function
specifier|protected
name|Schema
name|getSchema
parameter_list|()
block|{
return|return
name|getSchema
argument_list|(
literal|null
argument_list|)
return|;
block|}
end_function

begin_function
specifier|protected
name|Schema
name|getSchema
parameter_list|(
name|Class
argument_list|<
name|?
argument_list|>
name|cls
parameter_list|)
block|{
comment|// deal with the typical default case first
if|if
condition|(
name|schema
operator|==
literal|null
operator|&&
name|schemaHandlers
operator|==
literal|null
condition|)
block|{
return|return
literal|null
return|;
block|}
if|if
condition|(
name|schema
operator|!=
literal|null
condition|)
block|{
return|return
name|schema
return|;
block|}
name|SchemaHandler
name|handler
init|=
name|schemaHandlers
operator|.
name|get
argument_list|(
name|cls
operator|.
name|getName
argument_list|()
argument_list|)
decl_stmt|;
return|return
name|handler
operator|!=
literal|null
condition|?
name|handler
operator|.
name|getSchema
argument_list|()
else|:
literal|null
return|;
block|}
end_function

begin_function
specifier|public
name|void
name|clearContexts
parameter_list|()
block|{
name|classContexts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|packageContexts
operator|.
name|clear
argument_list|()
expr_stmt|;
block|}
end_function

begin_comment
comment|//TODO: move these methods into the dedicated utility class
end_comment

begin_function
specifier|protected
specifier|static
name|StringBuilder
name|handleExceptionStart
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
name|LOG
operator|.
name|warning
argument_list|(
name|ExceptionUtils
operator|.
name|getStackTrace
argument_list|(
name|e
argument_list|)
argument_list|)
expr_stmt|;
name|StringBuilder
name|sb
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
if|if
condition|(
name|e
operator|.
name|getMessage
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|sb
operator|.
name|append
argument_list|(
name|e
operator|.
name|getMessage
argument_list|()
argument_list|)
operator|.
name|append
argument_list|(
literal|". "
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|e
operator|.
name|getCause
argument_list|()
operator|!=
literal|null
operator|&&
name|e
operator|.
name|getCause
argument_list|()
operator|.
name|getMessage
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|sb
operator|.
name|append
argument_list|(
name|e
operator|.
name|getCause
argument_list|()
operator|.
name|getMessage
argument_list|()
argument_list|)
operator|.
name|append
argument_list|(
literal|". "
argument_list|)
expr_stmt|;
block|}
return|return
name|sb
return|;
block|}
end_function

begin_function
specifier|protected
specifier|static
name|void
name|handleExceptionEnd
parameter_list|(
name|Throwable
name|t
parameter_list|,
name|String
name|message
parameter_list|,
name|boolean
name|read
parameter_list|)
block|{
name|Response
operator|.
name|Status
name|status
init|=
name|read
condition|?
name|Response
operator|.
name|Status
operator|.
name|BAD_REQUEST
else|:
name|Response
operator|.
name|Status
operator|.
name|INTERNAL_SERVER_ERROR
decl_stmt|;
name|Response
name|r
init|=
name|JAXRSUtils
operator|.
name|toResponseBuilder
argument_list|(
name|status
argument_list|)
operator|.
name|type
argument_list|(
name|MediaType
operator|.
name|TEXT_PLAIN
argument_list|)
operator|.
name|entity
argument_list|(
name|message
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
throw|throw
name|read
condition|?
name|ExceptionUtils
operator|.
name|toBadRequestException
argument_list|(
name|t
argument_list|,
name|r
argument_list|)
else|:
name|ExceptionUtils
operator|.
name|toInternalServerErrorException
argument_list|(
name|t
argument_list|,
name|r
argument_list|)
throw|;
block|}
end_function

begin_function
specifier|protected
name|void
name|handleJAXBException
parameter_list|(
name|JAXBException
name|e
parameter_list|,
name|boolean
name|read
parameter_list|)
block|{
name|StringBuilder
name|sb
init|=
name|handleExceptionStart
argument_list|(
name|e
argument_list|)
decl_stmt|;
name|Throwable
name|linked
init|=
name|e
operator|.
name|getLinkedException
argument_list|()
decl_stmt|;
if|if
condition|(
name|linked
operator|!=
literal|null
operator|&&
name|linked
operator|.
name|getMessage
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|Throwable
name|cause
init|=
name|linked
decl_stmt|;
while|while
condition|(
name|read
operator|&&
name|cause
operator|!=
literal|null
condition|)
block|{
if|if
condition|(
name|cause
operator|instanceof
name|XMLStreamException
operator|&&
name|cause
operator|.
name|getMessage
argument_list|()
operator|.
name|startsWith
argument_list|(
literal|"Maximum Number"
argument_list|)
condition|)
block|{
throw|throw
name|ExceptionUtils
operator|.
name|toWebApplicationException
argument_list|(
literal|null
argument_list|,
name|JAXRSUtils
operator|.
name|toResponse
argument_list|(
literal|413
argument_list|)
argument_list|)
throw|;
block|}
if|if
condition|(
name|cause
operator|instanceof
name|DepthExceededStaxException
condition|)
block|{
throw|throw
name|ExceptionUtils
operator|.
name|toWebApplicationException
argument_list|(
literal|null
argument_list|,
name|JAXRSUtils
operator|.
name|toResponse
argument_list|(
literal|413
argument_list|)
argument_list|)
throw|;
block|}
name|cause
operator|=
name|cause
operator|.
name|getCause
argument_list|()
expr_stmt|;
block|}
name|String
name|msg
init|=
name|linked
operator|.
name|getMessage
argument_list|()
decl_stmt|;
if|if
condition|(
name|sb
operator|.
name|lastIndexOf
argument_list|(
name|msg
argument_list|)
operator|==
operator|-
literal|1
condition|)
block|{
name|sb
operator|.
name|append
argument_list|(
name|msg
argument_list|)
operator|.
name|append
argument_list|(
literal|". "
argument_list|)
expr_stmt|;
block|}
block|}
name|Throwable
name|t
init|=
name|linked
operator|!=
literal|null
condition|?
name|linked
else|:
name|e
operator|.
name|getCause
argument_list|()
operator|!=
literal|null
condition|?
name|e
operator|.
name|getCause
argument_list|()
else|:
name|e
decl_stmt|;
name|String
name|message
init|=
operator|new
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|common
operator|.
name|i18n
operator|.
name|Message
argument_list|(
literal|"JAXB_EXCEPTION"
argument_list|,
name|BUNDLE
argument_list|,
name|sb
operator|.
name|toString
argument_list|()
argument_list|)
operator|.
name|toString
argument_list|()
decl_stmt|;
name|handleExceptionEnd
argument_list|(
name|t
argument_list|,
name|message
argument_list|,
name|read
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|protected
name|void
name|handleXMLStreamException
parameter_list|(
name|XMLStreamException
name|e
parameter_list|,
name|boolean
name|read
parameter_list|)
block|{
name|StringBuilder
name|sb
init|=
name|handleExceptionStart
argument_list|(
name|e
argument_list|)
decl_stmt|;
name|handleExceptionEnd
argument_list|(
name|e
argument_list|,
name|sb
operator|.
name|toString
argument_list|()
argument_list|,
name|read
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|void
name|setOutTransformElements
parameter_list|(
name|Map
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|outElements
parameter_list|)
block|{
name|this
operator|.
name|outElementsMap
operator|=
name|outElements
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|void
name|setInAppendElements
parameter_list|(
name|Map
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|inElements
parameter_list|)
block|{
name|this
operator|.
name|inAppendMap
operator|=
name|inElements
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|void
name|setInTransformElements
parameter_list|(
name|Map
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|inElements
parameter_list|)
block|{
name|this
operator|.
name|inElementsMap
operator|=
name|inElements
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|void
name|setOutAppendElements
parameter_list|(
name|Map
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|map
parameter_list|)
block|{
name|this
operator|.
name|outAppendMap
operator|=
name|map
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|void
name|setOutDropElements
parameter_list|(
name|List
argument_list|<
name|String
argument_list|>
name|dropElementsSet
parameter_list|)
block|{
name|this
operator|.
name|outDropElements
operator|=
name|dropElementsSet
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|void
name|setInDropElements
parameter_list|(
name|List
argument_list|<
name|String
argument_list|>
name|dropElementsSet
parameter_list|)
block|{
name|this
operator|.
name|inDropElements
operator|=
name|dropElementsSet
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|void
name|setAttributesToElements
parameter_list|(
name|boolean
name|value
parameter_list|)
block|{
name|this
operator|.
name|attributesToElements
operator|=
name|value
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|void
name|setSkipJaxbChecks
parameter_list|(
name|boolean
name|skipJaxbChecks
parameter_list|)
block|{
name|this
operator|.
name|skipJaxbChecks
operator|=
name|skipJaxbChecks
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|boolean
name|isSkipJaxbChecks
parameter_list|()
block|{
return|return
name|skipJaxbChecks
return|;
block|}
end_function

begin_function
specifier|protected
name|XMLStreamWriter
name|createTransformWriterIfNeeded
parameter_list|(
name|XMLStreamWriter
name|writer
parameter_list|,
name|OutputStream
name|os
parameter_list|,
name|boolean
name|dropAtXmlLevel
parameter_list|)
block|{
return|return
name|TransformUtils
operator|.
name|createTransformWriterIfNeeded
argument_list|(
name|writer
argument_list|,
name|os
argument_list|,
name|outElementsMap
argument_list|,
name|dropAtXmlLevel
condition|?
name|outDropElements
else|:
literal|null
argument_list|,
name|outAppendMap
argument_list|,
name|attributesToElements
argument_list|,
literal|null
argument_list|)
return|;
block|}
end_function

begin_function
specifier|protected
name|XMLStreamReader
name|createTransformReaderIfNeeded
parameter_list|(
name|XMLStreamReader
name|reader
parameter_list|,
name|InputStream
name|is
parameter_list|)
block|{
return|return
name|TransformUtils
operator|.
name|createTransformReaderIfNeeded
argument_list|(
name|reader
argument_list|,
name|is
argument_list|,
name|inDropElements
argument_list|,
name|inElementsMap
argument_list|,
name|inAppendMap
argument_list|,
literal|true
argument_list|)
return|;
block|}
end_function

begin_function
specifier|protected
name|XMLStreamReader
name|createDepthReaderIfNeeded
parameter_list|(
name|XMLStreamReader
name|reader
parameter_list|,
name|InputStream
name|is
parameter_list|)
block|{
name|DocumentDepthProperties
name|props
init|=
name|getDepthProperties
argument_list|()
decl_stmt|;
if|if
condition|(
name|props
operator|!=
literal|null
operator|&&
name|props
operator|.
name|isEffective
argument_list|()
condition|)
block|{
name|reader
operator|=
name|TransformUtils
operator|.
name|createNewReaderIfNeeded
argument_list|(
name|reader
argument_list|,
name|is
argument_list|)
expr_stmt|;
name|reader
operator|=
operator|new
name|DepthRestrictingStreamReader
argument_list|(
name|reader
argument_list|,
name|props
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|reader
operator|!=
literal|null
condition|)
block|{
name|reader
operator|=
name|configureReaderRestrictions
argument_list|(
name|reader
argument_list|)
expr_stmt|;
block|}
return|return
name|reader
return|;
block|}
end_function

begin_function
specifier|protected
name|XMLStreamReader
name|configureReaderRestrictions
parameter_list|(
name|XMLStreamReader
name|reader
parameter_list|)
block|{
name|Message
name|message
init|=
name|PhaseInterceptorChain
operator|.
name|getCurrentMessage
argument_list|()
decl_stmt|;
if|if
condition|(
name|message
operator|!=
literal|null
condition|)
block|{
try|try
block|{
return|return
name|StaxUtils
operator|.
name|configureReader
argument_list|(
name|reader
argument_list|,
name|message
argument_list|)
return|;
block|}
catch|catch
parameter_list|(
name|XMLStreamException
name|ex
parameter_list|)
block|{
throw|throw
name|ExceptionUtils
operator|.
name|toInternalServerErrorException
argument_list|(
name|ex
argument_list|,
literal|null
argument_list|)
throw|;
block|}
block|}
return|return
name|reader
return|;
block|}
end_function

begin_function
specifier|protected
name|DocumentDepthProperties
name|getDepthProperties
parameter_list|()
block|{
return|return
name|depthProperties
return|;
block|}
end_function

begin_function
specifier|public
name|void
name|setValidateBeforeWrite
parameter_list|(
name|boolean
name|validateBeforeWrite
parameter_list|)
block|{
name|this
operator|.
name|validateBeforeWrite
operator|=
name|validateBeforeWrite
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|void
name|setValidateOutput
parameter_list|(
name|boolean
name|validateOutput
parameter_list|)
block|{
name|this
operator|.
name|validateOutputIfPossible
operator|=
name|validateOutput
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|void
name|setValidateInput
parameter_list|(
name|boolean
name|validateInput
parameter_list|)
block|{
name|this
operator|.
name|validateInputIfPossible
operator|=
name|validateInput
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|void
name|setDepthProperties
parameter_list|(
name|DocumentDepthProperties
name|depthProperties
parameter_list|)
block|{
name|this
operator|.
name|depthProperties
operator|=
name|depthProperties
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|void
name|setUnmarshallerListener
parameter_list|(
name|Unmarshaller
operator|.
name|Listener
name|unmarshallerListener
parameter_list|)
block|{
name|this
operator|.
name|unmarshallerListener
operator|=
name|unmarshallerListener
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|void
name|setMarshallerListener
parameter_list|(
name|Marshaller
operator|.
name|Listener
name|marshallerListener
parameter_list|)
block|{
name|this
operator|.
name|marshallerListener
operator|=
name|marshallerListener
expr_stmt|;
block|}
end_function

begin_function
specifier|public
name|void
name|setNamespaceMapperPropertyName
parameter_list|(
name|String
name|namespaceMapperProperty
parameter_list|)
block|{
name|this
operator|.
name|namespaceMapperPropertyName
operator|=
name|namespaceMapperProperty
expr_stmt|;
block|}
end_function

begin_class
annotation|@
name|XmlRootElement
specifier|protected
specifier|static
class|class
name|CollectionWrapper
block|{
annotation|@
name|XmlAnyElement
argument_list|(
name|lax
operator|=
literal|true
argument_list|)
specifier|private
name|List
argument_list|<
name|?
argument_list|>
name|l
decl_stmt|;
specifier|public
name|void
name|setList
parameter_list|(
name|List
argument_list|<
name|?
argument_list|>
name|list
parameter_list|)
block|{
name|l
operator|=
name|list
expr_stmt|;
block|}
specifier|public
name|List
argument_list|<
name|?
argument_list|>
name|getList
parameter_list|()
block|{
if|if
condition|(
name|l
operator|==
literal|null
condition|)
block|{
name|l
operator|=
operator|new
name|ArrayList
argument_list|<>
argument_list|()
expr_stmt|;
block|}
return|return
name|l
return|;
block|}
annotation|@
name|SuppressWarnings
argument_list|(
literal|"unchecked"
argument_list|)
specifier|public
parameter_list|<
name|T
parameter_list|>
name|Object
name|getCollectionOrArray
parameter_list|(
name|Unmarshaller
name|unm
parameter_list|,
name|Class
argument_list|<
name|T
argument_list|>
name|type
parameter_list|,
name|Class
argument_list|<
name|?
argument_list|>
name|collectionType
parameter_list|,
name|Type
name|genericType
parameter_list|,
name|XmlJavaTypeAdapter
name|adapter
parameter_list|)
throws|throws
name|JAXBException
block|{
name|List
argument_list|<
name|?
argument_list|>
name|theList
init|=
name|getList
argument_list|()
decl_stmt|;
name|boolean
name|adapterChecked
init|=
literal|false
decl_stmt|;
if|if
condition|(
operator|!
name|theList
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|Object
name|first
init|=
name|theList
operator|.
name|get
argument_list|(
literal|0
argument_list|)
decl_stmt|;
if|if
condition|(
name|first
operator|instanceof
name|Element
condition|)
block|{
name|List
argument_list|<
name|Object
argument_list|>
name|newList
init|=
operator|new
name|ArrayList
argument_list|<>
argument_list|(
name|theList
operator|.
name|size
argument_list|()
argument_list|)
decl_stmt|;
for|for
control|(
name|Object
name|o
range|:
name|theList
control|)
block|{
name|newList
operator|.
name|add
argument_list|(
name|unm
operator|.
name|unmarshal
argument_list|(
operator|(
name|Element
operator|)
name|o
argument_list|,
name|type
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|theList
operator|=
name|newList
expr_stmt|;
block|}
name|first
operator|=
name|theList
operator|.
name|get
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|Type
index|[]
name|types
init|=
name|InjectionUtils
operator|.
name|getActualTypes
argument_list|(
name|genericType
argument_list|)
decl_stmt|;
name|boolean
name|isJaxbElement
init|=
name|types
operator|!=
literal|null
operator|&&
name|types
operator|.
name|length
operator|>
literal|0
operator|&&
name|InjectionUtils
operator|.
name|getRawType
argument_list|(
name|types
index|[
literal|0
index|]
argument_list|)
operator|==
name|JAXBElement
operator|.
name|class
decl_stmt|;
if|if
condition|(
name|first
operator|instanceof
name|JAXBElement
operator|&&
operator|!
name|isJaxbElement
operator|&&
operator|!
name|JAXBElement
operator|.
name|class
operator|.
name|isAssignableFrom
argument_list|(
name|type
argument_list|)
condition|)
block|{
name|adapterChecked
operator|=
literal|true
expr_stmt|;
name|List
argument_list|<
name|Object
argument_list|>
name|newList
init|=
operator|new
name|ArrayList
argument_list|<>
argument_list|(
name|theList
operator|.
name|size
argument_list|()
argument_list|)
decl_stmt|;
for|for
control|(
name|Object
name|o
range|:
name|theList
control|)
block|{
name|newList
operator|.
name|add
argument_list|(
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|jaxrs
operator|.
name|utils
operator|.
name|JAXBUtils
operator|.
name|useAdapter
argument_list|(
operator|(
operator|(
name|JAXBElement
argument_list|<
name|?
argument_list|>
operator|)
name|o
operator|)
operator|.
name|getValue
argument_list|()
argument_list|,
name|adapter
argument_list|,
literal|false
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|theList
operator|=
name|newList
expr_stmt|;
block|}
elseif|else
if|if
condition|(
operator|!
operator|(
name|first
operator|instanceof
name|JAXBElement
operator|)
operator|&&
name|isJaxbElement
condition|)
block|{
name|List
argument_list|<
name|Object
argument_list|>
name|newList
init|=
operator|new
name|ArrayList
argument_list|<>
argument_list|(
name|theList
operator|.
name|size
argument_list|()
argument_list|)
decl_stmt|;
name|XmlRootElement
name|root
init|=
name|type
operator|.
name|getAnnotation
argument_list|(
name|XmlRootElement
operator|.
name|class
argument_list|)
decl_stmt|;
name|QName
name|qname
init|=
name|getQNameFromNamespaceAndName
argument_list|(
name|root
operator|.
name|namespace
argument_list|()
argument_list|,
name|root
operator|.
name|name
argument_list|()
argument_list|,
name|type
argument_list|,
literal|false
argument_list|)
decl_stmt|;
annotation|@
name|SuppressWarnings
argument_list|(
literal|"rawtypes"
argument_list|)
name|Class
name|theType
init|=
name|type
decl_stmt|;
for|for
control|(
name|Object
name|o
range|:
name|theList
control|)
block|{
name|newList
operator|.
name|add
argument_list|(
operator|new
name|JAXBElement
argument_list|<
name|Object
argument_list|>
argument_list|(
name|qname
argument_list|,
name|theType
argument_list|,
literal|null
argument_list|,
name|o
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|theList
operator|=
name|newList
expr_stmt|;
block|}
block|}
if|if
condition|(
name|collectionType
operator|.
name|isArray
argument_list|()
condition|)
block|{
name|T
index|[]
name|values
init|=
operator|(
name|T
index|[]
operator|)
name|Array
operator|.
name|newInstance
argument_list|(
name|type
argument_list|,
name|theList
operator|.
name|size
argument_list|()
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|theList
operator|.
name|size
argument_list|()
condition|;
name|i
operator|++
control|)
block|{
name|values
index|[
name|i
index|]
operator|=
operator|(
name|T
operator|)
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|jaxrs
operator|.
name|utils
operator|.
name|JAXBUtils
operator|.
name|useAdapter
argument_list|(
name|theList
operator|.
name|get
argument_list|(
name|i
argument_list|)
argument_list|,
name|adapter
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
return|return
name|values
return|;
block|}
if|if
condition|(
operator|!
name|adapterChecked
operator|&&
name|adapter
operator|!=
literal|null
condition|)
block|{
name|List
argument_list|<
name|Object
argument_list|>
name|newList
init|=
operator|new
name|ArrayList
argument_list|<>
argument_list|(
name|theList
operator|.
name|size
argument_list|()
argument_list|)
decl_stmt|;
for|for
control|(
name|Object
name|o
range|:
name|theList
control|)
block|{
name|newList
operator|.
name|add
argument_list|(
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|jaxrs
operator|.
name|utils
operator|.
name|JAXBUtils
operator|.
name|useAdapter
argument_list|(
name|o
argument_list|,
name|adapter
argument_list|,
literal|false
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|theList
operator|=
name|newList
expr_stmt|;
block|}
if|if
condition|(
name|collectionType
operator|==
name|Set
operator|.
name|class
condition|)
block|{
return|return
operator|new
name|HashSet
argument_list|<>
argument_list|(
name|theList
argument_list|)
return|;
block|}
return|return
name|theList
return|;
block|}
block|}
end_class

begin_class
specifier|protected
specifier|static
class|class
name|JAXBCollectionWrapperReader
extends|extends
name|DepthXMLStreamReader
block|{
specifier|private
name|boolean
name|firstName
decl_stmt|;
specifier|private
name|boolean
name|firstNs
decl_stmt|;
specifier|public
name|JAXBCollectionWrapperReader
parameter_list|(
name|XMLStreamReader
name|reader
parameter_list|)
block|{
name|super
argument_list|(
name|reader
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
specifier|public
name|String
name|getNamespaceURI
parameter_list|()
block|{
if|if
condition|(
operator|!
name|firstNs
condition|)
block|{
name|firstNs
operator|=
literal|true
expr_stmt|;
return|return
literal|""
return|;
block|}
return|return
name|super
operator|.
name|getNamespaceURI
argument_list|()
return|;
block|}
annotation|@
name|Override
specifier|public
name|String
name|getLocalName
parameter_list|()
block|{
if|if
condition|(
operator|!
name|firstName
condition|)
block|{
name|firstName
operator|=
literal|true
expr_stmt|;
return|return
literal|"collectionWrapper"
return|;
block|}
return|return
name|super
operator|.
name|getLocalName
argument_list|()
return|;
block|}
block|}
end_class

unit|}
end_unit

