begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_comment
comment|/**  * Licensed to the Apache Software Foundation (ASF) under one  * or more contributor license agreements. See the NOTICE file  * distributed with this work for additional information  * regarding copyright ownership. The ASF licenses this file  * to you under the Apache License, Version 2.0 (the  * "License"); you may not use this file except in compliance  * with the License. You may obtain a copy of the License at  *  * http://www.apache.org/licenses/LICENSE-2.0  *  * Unless required by applicable law or agreed to in writing,  * software distributed under the License is distributed on an  * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY  * KIND, either express or implied. See the License for the  * specific language governing permissions and limitations  * under the License.  */
end_comment

begin_package
package|package
name|org
operator|.
name|apache
operator|.
name|cxf
operator|.
name|profile
package|;
end_package

begin_import
import|import
name|com
operator|.
name|ctc
operator|.
name|wstx
operator|.
name|sax
operator|.
name|WstxSAXParserFactory
import|;
end_import

begin_import
import|import
name|com
operator|.
name|sun
operator|.
name|xml
operator|.
name|fastinfoset
operator|.
name|dom
operator|.
name|DOMDocumentParser
import|;
end_import

begin_import
import|import
name|com
operator|.
name|sun
operator|.
name|xml
operator|.
name|fastinfoset
operator|.
name|sax
operator|.
name|SAXDocumentParser
import|;
end_import

begin_import
import|import
name|com
operator|.
name|sun
operator|.
name|xml
operator|.
name|fastinfoset
operator|.
name|sax
operator|.
name|SAXDocumentSerializer
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|BufferedInputStream
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|File
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|FileInputStream
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|FileNotFoundException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|FileOutputStream
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|IOException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|InputStream
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|OutputStream
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|parsers
operator|.
name|DocumentBuilder
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|parsers
operator|.
name|DocumentBuilderFactory
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|parsers
operator|.
name|ParserConfigurationException
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|parsers
operator|.
name|SAXParser
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|parsers
operator|.
name|SAXParserFactory
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|transform
operator|.
name|TransformerConfigurationException
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|transform
operator|.
name|TransformerException
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|transform
operator|.
name|TransformerFactory
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|transform
operator|.
name|dom
operator|.
name|DOMResult
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|xml
operator|.
name|transform
operator|.
name|sax
operator|.
name|SAXSource
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jvnet
operator|.
name|fastinfoset
operator|.
name|FastInfosetException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|w3c
operator|.
name|dom
operator|.
name|Document
import|;
end_import

begin_import
import|import
name|org
operator|.
name|xml
operator|.
name|sax
operator|.
name|InputSource
import|;
end_import

begin_import
import|import
name|org
operator|.
name|xml
operator|.
name|sax
operator|.
name|SAXException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|xml
operator|.
name|sax
operator|.
name|SAXNotRecognizedException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|xml
operator|.
name|sax
operator|.
name|SAXNotSupportedException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|xml
operator|.
name|sax
operator|.
name|XMLReader
import|;
end_import

begin_class
specifier|public
class|class
name|FastInfosetExperiment
block|{
specifier|private
name|DocumentBuilder
name|documentBuilder
decl_stmt|;
name|TransformerFactory
name|transformerFactory
decl_stmt|;
specifier|private
name|File
name|fiFile
decl_stmt|;
specifier|private
specifier|final
specifier|static
name|int
name|iterCount
init|=
literal|10000
decl_stmt|;
specifier|private
name|FastInfosetExperiment
parameter_list|()
throws|throws
name|ParserConfigurationException
block|{
name|documentBuilder
operator|=
name|DocumentBuilderFactory
operator|.
name|newInstance
argument_list|()
operator|.
name|newDocumentBuilder
argument_list|()
expr_stmt|;
name|transformerFactory
operator|=
name|TransformerFactory
operator|.
name|newInstance
argument_list|()
expr_stmt|;
name|fiFile
operator|=
operator|new
name|File
argument_list|(
literal|"fiTest.fixml"
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|dehydrate
parameter_list|(
name|InputStream
name|input
parameter_list|,
name|OutputStream
name|output
parameter_list|)
throws|throws
name|ParserConfigurationException
throws|,
name|SAXException
throws|,
name|IOException
block|{
comment|// Create Fast Infoset SAX serializer
name|SAXDocumentSerializer
name|saxDocumentSerializer
init|=
operator|new
name|SAXDocumentSerializer
argument_list|()
decl_stmt|;
comment|// Set the output stream
name|saxDocumentSerializer
operator|.
name|setOutputStream
argument_list|(
name|output
argument_list|)
expr_stmt|;
comment|// Instantiate JAXP SAX parser factory
name|SAXParserFactory
name|saxParserFactory
init|=
name|SAXParserFactory
operator|.
name|newInstance
argument_list|()
decl_stmt|;
comment|/* Set parser to be namespace aware          * Very important to do otherwise invalid FI documents will be          * created by the SAXDocumentSerializer          */
name|saxParserFactory
operator|.
name|setNamespaceAware
argument_list|(
literal|true
argument_list|)
expr_stmt|;
comment|// Instantiate the JAXP SAX parser
name|SAXParser
name|saxParser
init|=
name|saxParserFactory
operator|.
name|newSAXParser
argument_list|()
decl_stmt|;
comment|// Set the lexical handler
name|saxParser
operator|.
name|setProperty
argument_list|(
literal|"http://xml.org/sax/properties/lexical-handler"
argument_list|,
name|saxDocumentSerializer
argument_list|)
expr_stmt|;
comment|// Parse the XML document and convert to a fast infoset document
name|saxParser
operator|.
name|parse
argument_list|(
name|input
argument_list|,
name|saxDocumentSerializer
argument_list|)
expr_stmt|;
block|}
specifier|private
name|void
name|readWithWoodstox
parameter_list|()
throws|throws
name|SAXException
throws|,
name|TransformerConfigurationException
throws|,
name|TransformerException
throws|,
name|IOException
block|{
name|InputStream
name|is
init|=
name|getClass
argument_list|()
operator|.
name|getResourceAsStream
argument_list|(
literal|"/META-INF/cxf/cxf.xml"
argument_list|)
decl_stmt|;
name|WstxSAXParserFactory
name|woodstoxParserFactory
decl_stmt|;
name|woodstoxParserFactory
operator|=
operator|new
name|WstxSAXParserFactory
argument_list|()
expr_stmt|;
name|woodstoxParserFactory
operator|.
name|setFeature
argument_list|(
literal|"http://xml.org/sax/features/namespace-prefixes"
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|SAXParser
name|parser
init|=
name|woodstoxParserFactory
operator|.
name|newSAXParser
argument_list|()
decl_stmt|;
name|XMLReader
name|reader
init|=
name|parser
operator|.
name|getXMLReader
argument_list|()
decl_stmt|;
name|SAXSource
name|saxSource
init|=
operator|new
name|SAXSource
argument_list|(
name|reader
argument_list|,
operator|new
name|InputSource
argument_list|(
name|is
argument_list|)
argument_list|)
decl_stmt|;
name|Document
name|document
decl_stmt|;
name|document
operator|=
name|documentBuilder
operator|.
name|newDocument
argument_list|()
expr_stmt|;
name|DOMResult
name|domResult
init|=
operator|new
name|DOMResult
argument_list|(
name|document
argument_list|)
decl_stmt|;
name|transformerFactory
operator|.
name|newTransformer
argument_list|()
operator|.
name|transform
argument_list|(
name|saxSource
argument_list|,
name|domResult
argument_list|)
expr_stmt|;
name|is
operator|.
name|close
argument_list|()
expr_stmt|;
block|}
specifier|private
name|void
name|readWithFI
parameter_list|()
throws|throws
name|TransformerConfigurationException
throws|,
name|TransformerException
throws|,
name|IOException
block|{
name|InputStream
name|is
init|=
operator|new
name|FileInputStream
argument_list|(
name|fiFile
argument_list|)
decl_stmt|;
name|XMLReader
name|saxReader
init|=
operator|new
name|SAXDocumentParser
argument_list|()
decl_stmt|;
name|InputStream
name|in
init|=
operator|new
name|BufferedInputStream
argument_list|(
name|is
argument_list|)
decl_stmt|;
name|SAXSource
name|saxSource
init|=
operator|new
name|SAXSource
argument_list|(
name|saxReader
argument_list|,
operator|new
name|InputSource
argument_list|(
name|in
argument_list|)
argument_list|)
decl_stmt|;
name|Document
name|document
decl_stmt|;
name|document
operator|=
name|documentBuilder
operator|.
name|newDocument
argument_list|()
expr_stmt|;
name|DOMResult
name|domResult
init|=
operator|new
name|DOMResult
argument_list|(
name|document
argument_list|)
decl_stmt|;
name|transformerFactory
operator|.
name|newTransformer
argument_list|()
operator|.
name|transform
argument_list|(
name|saxSource
argument_list|,
name|domResult
argument_list|)
expr_stmt|;
name|is
operator|.
name|close
argument_list|()
expr_stmt|;
block|}
specifier|private
name|void
name|readWithFIDom
parameter_list|()
throws|throws
name|FastInfosetException
throws|,
name|IOException
block|{
name|InputStream
name|is
init|=
operator|new
name|FileInputStream
argument_list|(
name|fiFile
argument_list|)
decl_stmt|;
name|DOMDocumentParser
name|ddp
init|=
operator|new
name|DOMDocumentParser
argument_list|()
decl_stmt|;
name|Document
name|document
decl_stmt|;
name|document
operator|=
name|documentBuilder
operator|.
name|newDocument
argument_list|()
expr_stmt|;
name|ddp
operator|.
name|parse
argument_list|(
name|document
argument_list|,
name|is
argument_list|)
expr_stmt|;
name|is
operator|.
name|close
argument_list|()
expr_stmt|;
block|}
specifier|private
name|void
name|benchmark
parameter_list|()
throws|throws
name|ParserConfigurationException
throws|,
name|SAXException
throws|,
name|IOException
throws|,
name|TransformerConfigurationException
throws|,
name|TransformerException
throws|,
name|FastInfosetException
block|{
name|InputStream
name|is
init|=
name|getClass
argument_list|()
operator|.
name|getResourceAsStream
argument_list|(
literal|"/META-INF/cxf/cxf.xml"
argument_list|)
decl_stmt|;
name|OutputStream
name|os
init|=
operator|new
name|FileOutputStream
argument_list|(
name|fiFile
argument_list|)
decl_stmt|;
name|dehydrate
argument_list|(
name|is
argument_list|,
name|os
argument_list|)
expr_stmt|;
name|is
operator|.
name|close
argument_list|()
expr_stmt|;
name|os
operator|.
name|close
argument_list|()
expr_stmt|;
name|long
name|totalTime
init|=
literal|0
decl_stmt|;
for|for
control|(
name|int
name|x
init|=
literal|0
init|;
name|x
operator|<
name|iterCount
condition|;
name|x
operator|++
control|)
block|{
name|long
name|startTime
init|=
name|System
operator|.
name|nanoTime
argument_list|()
decl_stmt|;
name|readWithWoodstox
argument_list|()
expr_stmt|;
name|long
name|endTime
init|=
name|System
operator|.
name|nanoTime
argument_list|()
decl_stmt|;
name|totalTime
operator|+=
name|endTime
operator|-
name|startTime
expr_stmt|;
block|}
name|double
name|averageNanos
init|=
name|totalTime
operator|/
name|iterCount
decl_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"Woodstox average us: "
operator|+
name|averageNanos
operator|/
literal|1000
argument_list|)
expr_stmt|;
name|totalTime
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|int
name|x
init|=
literal|0
init|;
name|x
operator|<
name|iterCount
condition|;
name|x
operator|++
control|)
block|{
name|long
name|startTime
init|=
name|System
operator|.
name|nanoTime
argument_list|()
decl_stmt|;
name|readWithFI
argument_list|()
expr_stmt|;
name|long
name|endTime
init|=
name|System
operator|.
name|nanoTime
argument_list|()
decl_stmt|;
name|totalTime
operator|+=
name|endTime
operator|-
name|startTime
expr_stmt|;
block|}
name|averageNanos
operator|=
name|totalTime
operator|/
name|iterCount
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"FastInfoset average us: "
operator|+
name|averageNanos
operator|/
literal|1000
argument_list|)
expr_stmt|;
name|totalTime
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|int
name|x
init|=
literal|0
init|;
name|x
operator|<
name|iterCount
condition|;
name|x
operator|++
control|)
block|{
name|long
name|startTime
init|=
name|System
operator|.
name|nanoTime
argument_list|()
decl_stmt|;
name|readWithFIDom
argument_list|()
expr_stmt|;
name|long
name|endTime
init|=
name|System
operator|.
name|nanoTime
argument_list|()
decl_stmt|;
name|totalTime
operator|+=
name|endTime
operator|-
name|startTime
expr_stmt|;
block|}
name|averageNanos
operator|=
name|totalTime
operator|/
name|iterCount
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"FastInfoset DOM average us: "
operator|+
name|averageNanos
operator|/
literal|1000
argument_list|)
expr_stmt|;
block|}
specifier|public
specifier|static
name|void
name|main
parameter_list|(
name|String
index|[]
name|args
parameter_list|)
throws|throws
name|Exception
block|{
name|FastInfosetExperiment
name|that
init|=
operator|new
name|FastInfosetExperiment
argument_list|()
decl_stmt|;
name|that
operator|.
name|benchmark
argument_list|()
expr_stmt|;
block|}
block|}
end_class

end_unit

